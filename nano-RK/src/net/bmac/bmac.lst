   1               		.file	"bmac.c"
   2               	__SREG__ = 0x3f
   3               	__SP_H__ = 0x3e
   4               	__SP_L__ = 0x3d
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.global __do_copy_data
   8               		.global __do_clear_bss
  11               		.text
  12               	.Ltext0:
 146               	.global	rf_rx_callback
 148               	rf_rx_callback:
 149               		.stabd	46,0,0
   1:../../../src/net/bmac/bmac.c **** /******************************************************************************
   2:../../../src/net/bmac/bmac.c **** *  Nano-RK, a real-time operating system for sensor networks.
   3:../../../src/net/bmac/bmac.c **** *  Copyright (C) 2007, Real-Time and Multimedia Lab, Carnegie Mellon University
   4:../../../src/net/bmac/bmac.c **** *  All rights reserved.
   5:../../../src/net/bmac/bmac.c **** *
   6:../../../src/net/bmac/bmac.c **** *  This is the Open Source Version of Nano-RK included as part of a Dual
   7:../../../src/net/bmac/bmac.c **** *  Licensing Model. If you are unsure which license to use please refer to:
   8:../../../src/net/bmac/bmac.c **** *  http://www.nanork.org/nano-RK/wiki/Licensing
   9:../../../src/net/bmac/bmac.c **** *
  10:../../../src/net/bmac/bmac.c **** *  This program is free software: you can redistribute it and/or modify
  11:../../../src/net/bmac/bmac.c **** *  it under the terms of the GNU General Public License as published by
  12:../../../src/net/bmac/bmac.c **** *  the Free Software Foundation, version 2.0 of the License.
  13:../../../src/net/bmac/bmac.c **** *
  14:../../../src/net/bmac/bmac.c **** *  This program is distributed in the hope that it will be useful,
  15:../../../src/net/bmac/bmac.c **** *  but WITHOUT ANY WARRANTY; without even the implied warranty of
  16:../../../src/net/bmac/bmac.c **** *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  17:../../../src/net/bmac/bmac.c **** *  GNU General Public License for more details.
  18:../../../src/net/bmac/bmac.c **** *
  19:../../../src/net/bmac/bmac.c **** *  You should have received a copy of the GNU General Public License
  20:../../../src/net/bmac/bmac.c **** *  along with this program.  If not, see <http://www.gnu.org/licenses/>.
  21:../../../src/net/bmac/bmac.c **** *
  22:../../../src/net/bmac/bmac.c **** *  Contributing Authors (specific to this file):
  23:../../../src/net/bmac/bmac.c **** *  Anthony Rowe
  24:../../../src/net/bmac/bmac.c **** *******************************************************************************/
  25:../../../src/net/bmac/bmac.c **** 
  26:../../../src/net/bmac/bmac.c **** 
  27:../../../src/net/bmac/bmac.c **** 
  28:../../../src/net/bmac/bmac.c **** #include <include.h>
  29:../../../src/net/bmac/bmac.c **** #include <ulib.h>
  30:../../../src/net/bmac/bmac.c **** #include <stdlib.h>
  31:../../../src/net/bmac/bmac.c **** #include <avr/sleep.h>
  32:../../../src/net/bmac/bmac.c **** #include <avr/wdt.h>
  33:../../../src/net/bmac/bmac.c **** #include <avr/eeprom.h>
  34:../../../src/net/bmac/bmac.c **** #include <stdio.h>
  35:../../../src/net/bmac/bmac.c **** #include <avr/interrupt.h>
  36:../../../src/net/bmac/bmac.c **** #include <nrk.h>
  37:../../../src/net/bmac/bmac.c **** #include <nrk_events.h>
  38:../../../src/net/bmac/bmac.c **** #include <nrk_timer.h>
  39:../../../src/net/bmac/bmac.c **** #include <nrk_error.h>
  40:../../../src/net/bmac/bmac.c **** #include <nrk_reserve.h>
  41:../../../src/net/bmac/bmac.c **** #include <bmac.h>
  42:../../../src/net/bmac/bmac.c **** #include <nrk_cfg.h>
  43:../../../src/net/bmac/bmac.c **** 
  44:../../../src/net/bmac/bmac.c **** 
  45:../../../src/net/bmac/bmac.c **** #ifndef BMAC_STACKSIZE
  46:../../../src/net/bmac/bmac.c **** #define BMAC_STACKSIZE	128	
  47:../../../src/net/bmac/bmac.c **** #endif
  48:../../../src/net/bmac/bmac.c **** 
  49:../../../src/net/bmac/bmac.c **** static nrk_task_type bmac_task;
  50:../../../src/net/bmac/bmac.c **** static NRK_STK bmac_task_stack[BMAC_STACKSIZE];
  51:../../../src/net/bmac/bmac.c **** 
  52:../../../src/net/bmac/bmac.c **** 
  53:../../../src/net/bmac/bmac.c **** //#define DEBUG
  54:../../../src/net/bmac/bmac.c **** static uint32_t rx_failure_cnt;
  55:../../../src/net/bmac/bmac.c **** 
  56:../../../src/net/bmac/bmac.c **** static uint8_t tx_data_ready;
  57:../../../src/net/bmac/bmac.c **** static uint8_t rx_buf_empty;
  58:../../../src/net/bmac/bmac.c **** static uint8_t bmac_running;
  59:../../../src/net/bmac/bmac.c **** static uint8_t pkt_got_ack;
  60:../../../src/net/bmac/bmac.c **** static uint8_t g_chan;
  61:../../../src/net/bmac/bmac.c **** static uint8_t is_enabled;
  62:../../../src/net/bmac/bmac.c **** 
  63:../../../src/net/bmac/bmac.c **** static nrk_time_t _bmac_check_period;
  64:../../../src/net/bmac/bmac.c **** 
  65:../../../src/net/bmac/bmac.c **** static uint8_t cca_active;
  66:../../../src/net/bmac/bmac.c **** static int8_t tx_reserve;
  67:../../../src/net/bmac/bmac.c **** 
  68:../../../src/net/bmac/bmac.c **** 
  69:../../../src/net/bmac/bmac.c **** /**
  70:../../../src/net/bmac/bmac.c ****  *  This is a callback if you require immediate response to a packet
  71:../../../src/net/bmac/bmac.c ****  */
  72:../../../src/net/bmac/bmac.c **** RF_RX_INFO *rf_rx_callback (RF_RX_INFO * pRRI)
  73:../../../src/net/bmac/bmac.c **** {
 151               	.LM0:
 152               	.LFBB1:
 153               	/* prologue: function */
 154               	/* frame size = 0 */
 155               	/* epilogue start */
  74:../../../src/net/bmac/bmac.c ****     // Any code here gets called the instant a packet is received from the interrupt   
  75:../../../src/net/bmac/bmac.c ****     return pRRI;
  76:../../../src/net/bmac/bmac.c **** }
 157               	.LM1:
 158 0000 0895      		ret
 160               	.Lscope1:
 162               		.stabd	78,0,0
 166               	.global	bmac_tx_reserve_set
 168               	bmac_tx_reserve_set:
 169               		.stabd	46,0,0
  77:../../../src/net/bmac/bmac.c **** 
  78:../../../src/net/bmac/bmac.c **** int8_t bmac_encryption_set_ctr_counter(uint8_t *counter, uint8_t len)
  79:../../../src/net/bmac/bmac.c **** {
  80:../../../src/net/bmac/bmac.c **** if(len!=4 ) return NRK_ERROR;
  81:../../../src/net/bmac/bmac.c **** rf_security_set_ctr_counter(counter);
  82:../../../src/net/bmac/bmac.c ****    return NRK_OK;
  83:../../../src/net/bmac/bmac.c **** }
  84:../../../src/net/bmac/bmac.c **** 
  85:../../../src/net/bmac/bmac.c **** int8_t bmac_tx_reserve_set( nrk_time_t *period, uint16_t pkts )
  86:../../../src/net/bmac/bmac.c **** {
 171               	.LM2:
 172               	.LFBB2:
 173               	/* prologue: function */
 174               	/* frame size = 0 */
  87:../../../src/net/bmac/bmac.c **** 
  88:../../../src/net/bmac/bmac.c **** #ifdef NRK_MAX_RESERVES
  89:../../../src/net/bmac/bmac.c **** // Create a reserve if it doesn't exist
  90:../../../src/net/bmac/bmac.c **** if(tx_reserve==-1) tx_reserve=nrk_reserve_create();
  91:../../../src/net/bmac/bmac.c **** if(tx_reserve>=0)
  92:../../../src/net/bmac/bmac.c ****   return nrk_reserve_set(tx_reserve, period,pkts,NULL);
  93:../../../src/net/bmac/bmac.c **** else return NRK_ERROR;
  94:../../../src/net/bmac/bmac.c **** #else
  95:../../../src/net/bmac/bmac.c **** return NRK_ERROR;
  96:../../../src/net/bmac/bmac.c **** #endif
  97:../../../src/net/bmac/bmac.c **** }
 176               	.LM3:
 177 0002 8FEF      		ldi r24,lo8(-1)
 178               	/* epilogue start */
 179 0004 0895      		ret
 181               	.Lscope2:
 183               		.stabd	78,0,0
 185               	.global	bmac_tx_reserve_get
 187               	bmac_tx_reserve_get:
 188               		.stabd	46,0,0
  98:../../../src/net/bmac/bmac.c **** 
  99:../../../src/net/bmac/bmac.c **** uint16_t bmac_tx_reserve_get()
 100:../../../src/net/bmac/bmac.c **** {
 190               	.LM4:
 191               	.LFBB3:
 192               	/* prologue: function */
 193               	/* frame size = 0 */
 101:../../../src/net/bmac/bmac.c **** #ifdef NRK_MAX_RESERVES
 102:../../../src/net/bmac/bmac.c **** if(tx_reserve>=0)
 103:../../../src/net/bmac/bmac.c ****   return nrk_reserve_get(tx_reserve);
 104:../../../src/net/bmac/bmac.c **** else return 0;
 105:../../../src/net/bmac/bmac.c **** #else
 106:../../../src/net/bmac/bmac.c **** return 0;
 107:../../../src/net/bmac/bmac.c **** #endif
 108:../../../src/net/bmac/bmac.c **** }
 195               	.LM5:
 196 0006 80E0      		ldi r24,lo8(0)
 197 0008 90E0      		ldi r25,hi8(0)
 198               	/* epilogue start */
 199 000a 0895      		ret
 201               	.Lscope3:
 203               		.stabd	78,0,0
 206               	.global	bmac_addr_decode_dest_mac
 208               	bmac_addr_decode_dest_mac:
 209               		.stabd	46,0,0
 109:../../../src/net/bmac/bmac.c **** 
 110:../../../src/net/bmac/bmac.c **** 
 111:../../../src/net/bmac/bmac.c **** int8_t  bmac_auto_ack_disable() 
 112:../../../src/net/bmac/bmac.c **** {
 113:../../../src/net/bmac/bmac.c **** rf_auto_ack_disable();
 114:../../../src/net/bmac/bmac.c **** return NRK_OK;
 115:../../../src/net/bmac/bmac.c **** }
 116:../../../src/net/bmac/bmac.c **** 
 117:../../../src/net/bmac/bmac.c **** int8_t  bmac_auto_ack_enable() 
 118:../../../src/net/bmac/bmac.c **** {
 119:../../../src/net/bmac/bmac.c **** rf_auto_ack_enable();
 120:../../../src/net/bmac/bmac.c **** return NRK_OK;
 121:../../../src/net/bmac/bmac.c **** }
 122:../../../src/net/bmac/bmac.c **** 
 123:../../../src/net/bmac/bmac.c **** int8_t  bmac_addr_decode_disable() 
 124:../../../src/net/bmac/bmac.c **** {
 125:../../../src/net/bmac/bmac.c **** rf_addr_decode_disable();
 126:../../../src/net/bmac/bmac.c **** return NRK_OK;
 127:../../../src/net/bmac/bmac.c **** }
 128:../../../src/net/bmac/bmac.c **** 
 129:../../../src/net/bmac/bmac.c **** int8_t  bmac_addr_decode_enable() 
 130:../../../src/net/bmac/bmac.c **** {
 131:../../../src/net/bmac/bmac.c **** rf_addr_decode_enable();
 132:../../../src/net/bmac/bmac.c **** return NRK_OK;
 133:../../../src/net/bmac/bmac.c **** }
 134:../../../src/net/bmac/bmac.c **** 
 135:../../../src/net/bmac/bmac.c **** int8_t bmac_addr_decode_set_my_mac(uint16_t my_mac)
 136:../../../src/net/bmac/bmac.c **** {
 137:../../../src/net/bmac/bmac.c **** rf_addr_decode_set_my_mac(my_mac);
 138:../../../src/net/bmac/bmac.c **** return NRK_OK;
 139:../../../src/net/bmac/bmac.c **** }
 140:../../../src/net/bmac/bmac.c **** 
 141:../../../src/net/bmac/bmac.c **** int8_t  bmac_addr_decode_dest_mac(uint16_t dest) 
 142:../../../src/net/bmac/bmac.c **** {
 211               	.LM6:
 212               	.LFBB4:
 213               	/* prologue: function */
 214               	/* frame size = 0 */
 143:../../../src/net/bmac/bmac.c **** bmac_rfTxInfo.destAddr=dest;
 216               	.LM7:
 217 000c 9093 0000 		sts (bmac_rfTxInfo)+1,r25
 218 0010 8093 0000 		sts bmac_rfTxInfo,r24
 144:../../../src/net/bmac/bmac.c **** return NRK_OK;
 145:../../../src/net/bmac/bmac.c **** }
 220               	.LM8:
 221 0014 81E0      		ldi r24,lo8(1)
 222               	/* epilogue start */
 223 0016 0895      		ret
 225               	.Lscope4:
 227               		.stabd	78,0,0
 230               	.global	bmac_set_cca_active
 232               	bmac_set_cca_active:
 233               		.stabd	46,0,0
 146:../../../src/net/bmac/bmac.c **** 
 147:../../../src/net/bmac/bmac.c **** int8_t bmac_rx_pkt_is_encrypted()
 148:../../../src/net/bmac/bmac.c **** {
 149:../../../src/net/bmac/bmac.c **** return rf_security_last_pkt_status();
 150:../../../src/net/bmac/bmac.c **** }
 151:../../../src/net/bmac/bmac.c **** 
 152:../../../src/net/bmac/bmac.c **** int8_t bmac_encryption_set_key(uint8_t *key, uint8_t len)
 153:../../../src/net/bmac/bmac.c **** {
 154:../../../src/net/bmac/bmac.c ****   if(len!=16) return NRK_ERROR;
 155:../../../src/net/bmac/bmac.c ****   rf_security_set_key(key);
 156:../../../src/net/bmac/bmac.c ****   return NRK_OK;
 157:../../../src/net/bmac/bmac.c **** }
 158:../../../src/net/bmac/bmac.c **** 
 159:../../../src/net/bmac/bmac.c **** int8_t bmac_encryption_enable()
 160:../../../src/net/bmac/bmac.c **** {
 161:../../../src/net/bmac/bmac.c ****   rf_security_enable();
 162:../../../src/net/bmac/bmac.c ****   return NRK_OK;
 163:../../../src/net/bmac/bmac.c **** }
 164:../../../src/net/bmac/bmac.c **** 
 165:../../../src/net/bmac/bmac.c **** int8_t bmac_encryption_disable()
 166:../../../src/net/bmac/bmac.c **** {
 167:../../../src/net/bmac/bmac.c ****   rf_security_disable();
 168:../../../src/net/bmac/bmac.c ****   return NRK_OK;
 169:../../../src/net/bmac/bmac.c **** }
 170:../../../src/net/bmac/bmac.c **** 
 171:../../../src/net/bmac/bmac.c **** 
 172:../../../src/net/bmac/bmac.c **** int8_t bmac_set_rf_power(uint8_t power)
 173:../../../src/net/bmac/bmac.c **** {
 174:../../../src/net/bmac/bmac.c **** if(power>31) return NRK_ERROR;
 175:../../../src/net/bmac/bmac.c **** rf_tx_power(power);
 176:../../../src/net/bmac/bmac.c **** return NRK_OK;
 177:../../../src/net/bmac/bmac.c **** }
 178:../../../src/net/bmac/bmac.c **** 
 179:../../../src/net/bmac/bmac.c **** void bmac_set_cca_active(uint8_t active)
 180:../../../src/net/bmac/bmac.c **** {
 235               	.LM9:
 236               	.LFBB5:
 237               	/* prologue: function */
 238               	/* frame size = 0 */
 181:../../../src/net/bmac/bmac.c **** cca_active=active;
 240               	.LM10:
 241 0018 8093 0000 		sts cca_active,r24
 242               	/* epilogue start */
 182:../../../src/net/bmac/bmac.c **** }
 244               	.LM11:
 245 001c 0895      		ret
 247               	.Lscope5:
 249               		.stabd	78,0,0
 253               	.global	bmac_rx_pkt_set_buffer
 255               	bmac_rx_pkt_set_buffer:
 256               		.stabd	46,0,0
 183:../../../src/net/bmac/bmac.c **** 
 184:../../../src/net/bmac/bmac.c **** int8_t bmac_set_cca_thresh(int8_t thresh)
 185:../../../src/net/bmac/bmac.c **** {
 186:../../../src/net/bmac/bmac.c ****   rf_set_cca_thresh(thresh); 
 187:../../../src/net/bmac/bmac.c **** return NRK_OK;
 188:../../../src/net/bmac/bmac.c **** }
 189:../../../src/net/bmac/bmac.c **** 
 190:../../../src/net/bmac/bmac.c **** int8_t bmac_set_channel(uint8_t chan)
 191:../../../src/net/bmac/bmac.c **** {
 192:../../../src/net/bmac/bmac.c **** if(chan>26) return NRK_ERROR;
 193:../../../src/net/bmac/bmac.c **** g_chan=chan;
 194:../../../src/net/bmac/bmac.c **** rf_init (&bmac_rfRxInfo, chan, 0xFFFF, 0x00000);
 195:../../../src/net/bmac/bmac.c **** return NRK_OK;
 196:../../../src/net/bmac/bmac.c **** }
 197:../../../src/net/bmac/bmac.c **** 
 198:../../../src/net/bmac/bmac.c **** 
 199:../../../src/net/bmac/bmac.c **** int8_t bmac_wait_until_rx_pkt()
 200:../../../src/net/bmac/bmac.c **** {
 201:../../../src/net/bmac/bmac.c **** nrk_sig_mask_t event;
 202:../../../src/net/bmac/bmac.c **** 
 203:../../../src/net/bmac/bmac.c **** if(bmac_rx_pkt_ready()==1) return NRK_OK;
 204:../../../src/net/bmac/bmac.c **** 
 205:../../../src/net/bmac/bmac.c ****     nrk_signal_register(bmac_rx_pkt_signal); 
 206:../../../src/net/bmac/bmac.c ****     event=nrk_event_wait (SIG(bmac_rx_pkt_signal));
 207:../../../src/net/bmac/bmac.c **** 
 208:../../../src/net/bmac/bmac.c **** // Check if it was a time out instead of packet RX signal
 209:../../../src/net/bmac/bmac.c **** if((event & SIG(bmac_rx_pkt_signal)) == 0 ) return NRK_ERROR;
 210:../../../src/net/bmac/bmac.c **** else return NRK_OK;
 211:../../../src/net/bmac/bmac.c **** }
 212:../../../src/net/bmac/bmac.c **** 
 213:../../../src/net/bmac/bmac.c **** int8_t bmac_rx_pkt_set_buffer(uint8_t *buf, uint8_t size)
 214:../../../src/net/bmac/bmac.c **** {
 258               	.LM12:
 259               	.LFBB6:
 260               	/* prologue: function */
 261               	/* frame size = 0 */
 215:../../../src/net/bmac/bmac.c **** if(buf==NULL) return NRK_ERROR;
 263               	.LM13:
 264 001e 0097      		sbiw r24,0
 265 0020 01F4      		brne .L12
 266 0022 8FEF      		ldi r24,lo8(-1)
 267 0024 0895      		ret
 268               	.L12:
 216:../../../src/net/bmac/bmac.c ****     bmac_rfRxInfo.pPayload = buf;
 270               	.LM14:
 271 0026 9093 0000 		sts (bmac_rfRxInfo+5)+1,r25
 272 002a 8093 0000 		sts bmac_rfRxInfo+5,r24
 217:../../../src/net/bmac/bmac.c ****     bmac_rfRxInfo.max_length = size;
 274               	.LM15:
 275 002e 6093 0000 		sts bmac_rfRxInfo+4,r22
 218:../../../src/net/bmac/bmac.c ****     rx_buf_empty=1;
 277               	.LM16:
 278 0032 81E0      		ldi r24,lo8(1)
 279 0034 8093 0000 		sts rx_buf_empty,r24
 219:../../../src/net/bmac/bmac.c **** return NRK_OK;
 220:../../../src/net/bmac/bmac.c **** }
 281               	.LM17:
 282 0038 0895      		ret
 284               	.Lscope6:
 286               		.stabd	78,0,0
 290               	.global	bmac_tx_pkt_nonblocking
 292               	bmac_tx_pkt_nonblocking:
 293               		.stabd	46,0,0
 221:../../../src/net/bmac/bmac.c **** 
 222:../../../src/net/bmac/bmac.c **** int8_t bmac_init (uint8_t chan)
 223:../../../src/net/bmac/bmac.c **** {
 224:../../../src/net/bmac/bmac.c ****     bmac_running=0;
 225:../../../src/net/bmac/bmac.c ****     tx_reserve=-1;
 226:../../../src/net/bmac/bmac.c ****     cca_active=true;
 227:../../../src/net/bmac/bmac.c ****     rx_failure_cnt=0;
 228:../../../src/net/bmac/bmac.c ****     #ifdef NRK_SW_WDT
 229:../../../src/net/bmac/bmac.c **** 	#ifdef BMAC_SW_WDT_ID
 230:../../../src/net/bmac/bmac.c **** 	
 231:../../../src/net/bmac/bmac.c **** 	_bmac_check_period.secs=30;
 232:../../../src/net/bmac/bmac.c **** 	_bmac_check_period.nano_secs=0;
 233:../../../src/net/bmac/bmac.c **** 	nrk_sw_wdt_init(BMAC_SW_WDT_ID, &_bmac_check_period, NULL );
 234:../../../src/net/bmac/bmac.c **** 	nrk_sw_wdt_start(BMAC_SW_WDT_ID);
 235:../../../src/net/bmac/bmac.c **** 	#endif
 236:../../../src/net/bmac/bmac.c ****     #endif
 237:../../../src/net/bmac/bmac.c **** 
 238:../../../src/net/bmac/bmac.c **** 
 239:../../../src/net/bmac/bmac.c **** 
 240:../../../src/net/bmac/bmac.c ****     _bmac_check_period.secs=0;
 241:../../../src/net/bmac/bmac.c ****     _bmac_check_period.nano_secs=BMAC_DEFAULT_CHECK_RATE_MS*NANOS_PER_MS;
 242:../../../src/net/bmac/bmac.c ****     bmac_rx_pkt_signal=nrk_signal_create();
 243:../../../src/net/bmac/bmac.c ****     if(bmac_rx_pkt_signal==NRK_ERROR)
 244:../../../src/net/bmac/bmac.c **** 	{
 245:../../../src/net/bmac/bmac.c **** 	nrk_kprintf(PSTR("BMAC ERROR: creating rx signal failed\r\n"));
 246:../../../src/net/bmac/bmac.c **** 	nrk_kernel_error_add(NRK_SIGNAL_CREATE_ERROR,nrk_cur_task_TCB->task_ID);
 247:../../../src/net/bmac/bmac.c **** 	return NRK_ERROR;
 248:../../../src/net/bmac/bmac.c **** 	}
 249:../../../src/net/bmac/bmac.c ****     bmac_tx_pkt_done_signal=nrk_signal_create();
 250:../../../src/net/bmac/bmac.c ****     if(bmac_tx_pkt_done_signal==NRK_ERROR)
 251:../../../src/net/bmac/bmac.c **** 	{
 252:../../../src/net/bmac/bmac.c **** 	nrk_kprintf(PSTR("BMAC ERROR: creating tx signal failed\r\n"));
 253:../../../src/net/bmac/bmac.c **** 	nrk_kernel_error_add(NRK_SIGNAL_CREATE_ERROR,nrk_cur_task_TCB->task_ID);
 254:../../../src/net/bmac/bmac.c **** 	return NRK_ERROR;
 255:../../../src/net/bmac/bmac.c **** 	}
 256:../../../src/net/bmac/bmac.c ****     bmac_enable_signal=nrk_signal_create();
 257:../../../src/net/bmac/bmac.c ****     if(bmac_enable_signal==NRK_ERROR)
 258:../../../src/net/bmac/bmac.c **** 	{
 259:../../../src/net/bmac/bmac.c **** 	nrk_kprintf(PSTR("BMAC ERROR: creating enable signal failed\r\n"));
 260:../../../src/net/bmac/bmac.c **** 	nrk_kernel_error_add(NRK_SIGNAL_CREATE_ERROR,nrk_cur_task_TCB->task_ID);
 261:../../../src/net/bmac/bmac.c **** 	return NRK_ERROR;
 262:../../../src/net/bmac/bmac.c **** 	}
 263:../../../src/net/bmac/bmac.c **** 
 264:../../../src/net/bmac/bmac.c ****      
 265:../../../src/net/bmac/bmac.c ****     tx_data_ready=0;
 266:../../../src/net/bmac/bmac.c ****     // Set the one main rx buffer
 267:../../../src/net/bmac/bmac.c ****     rx_buf_empty=0;
 268:../../../src/net/bmac/bmac.c ****     bmac_rfRxInfo.pPayload = NULL;
 269:../../../src/net/bmac/bmac.c ****     bmac_rfRxInfo.max_length = 0;
 270:../../../src/net/bmac/bmac.c **** 
 271:../../../src/net/bmac/bmac.c ****     // Setup the cc2420 chip
 272:../../../src/net/bmac/bmac.c ****     rf_init (&bmac_rfRxInfo, chan, 0xffff, 0);
 273:../../../src/net/bmac/bmac.c ****     g_chan=chan;
 274:../../../src/net/bmac/bmac.c ****  
 275:../../../src/net/bmac/bmac.c ****     FASTSPI_SETREG(CC2420_RSSI, 0xE580); // CCA THR=-25
 276:../../../src/net/bmac/bmac.c ****     FASTSPI_SETREG(CC2420_TXCTRL, 0x80FF); // TX TURNAROUND = 128 us
 277:../../../src/net/bmac/bmac.c ****     FASTSPI_SETREG(CC2420_RXCTRL1, 0x0A56); 
 278:../../../src/net/bmac/bmac.c ****     // default cca thresh of -45
 279:../../../src/net/bmac/bmac.c ****     //rf_set_cca_thresh(-45); 
 280:../../../src/net/bmac/bmac.c ****     rf_set_cca_thresh(-45); 
 281:../../../src/net/bmac/bmac.c ****     bmac_running=1;
 282:../../../src/net/bmac/bmac.c ****     is_enabled=1;
 283:../../../src/net/bmac/bmac.c ****     return NRK_OK;
 284:../../../src/net/bmac/bmac.c **** }
 285:../../../src/net/bmac/bmac.c **** 
 286:../../../src/net/bmac/bmac.c **** int8_t bmac_tx_pkt_nonblocking(uint8_t *buf, uint8_t len)
 287:../../../src/net/bmac/bmac.c **** {
 295               	.LM18:
 296               	.LFBB7:
 297               	/* prologue: function */
 298               	/* frame size = 0 */
 288:../../../src/net/bmac/bmac.c ****   if(tx_data_ready==1) return NRK_ERROR;
 300               	.LM19:
 301 003a 2091 0000 		lds r18,tx_data_ready
 302 003e 2130      		cpi r18,lo8(1)
 303 0040 01F4      		brne .L17
 304 0042 8FEF      		ldi r24,lo8(-1)
 305 0044 0895      		ret
 306               	.L17:
 289:../../../src/net/bmac/bmac.c ****   tx_data_ready=1;
 308               	.LM20:
 309 0046 21E0      		ldi r18,lo8(1)
 310 0048 2093 0000 		sts tx_data_ready,r18
 290:../../../src/net/bmac/bmac.c ****   bmac_rfTxInfo.pPayload=buf;
 312               	.LM21:
 313 004c 9093 0000 		sts (bmac_rfTxInfo+3)+1,r25
 314 0050 8093 0000 		sts bmac_rfTxInfo+3,r24
 291:../../../src/net/bmac/bmac.c ****   bmac_rfTxInfo.length=len;
 316               	.LM22:
 317 0054 6093 0000 		sts bmac_rfTxInfo+2,r22
 318 0058 81E0      		ldi r24,lo8(1)
 292:../../../src/net/bmac/bmac.c **** return NRK_OK;
 293:../../../src/net/bmac/bmac.c **** }
 320               	.LM23:
 321 005a 0895      		ret
 323               	.Lscope7:
 325               		.stabd	78,0,0
 329               	.global	bmac_rx_pkt_get
 331               	bmac_rx_pkt_get:
 332               		.stabd	46,0,0
 294:../../../src/net/bmac/bmac.c **** 
 295:../../../src/net/bmac/bmac.c **** nrk_sig_t bmac_get_rx_pkt_signal()
 296:../../../src/net/bmac/bmac.c **** {
 297:../../../src/net/bmac/bmac.c ****    nrk_signal_register(bmac_rx_pkt_signal); 
 298:../../../src/net/bmac/bmac.c **** return(bmac_rx_pkt_signal);
 299:../../../src/net/bmac/bmac.c **** }
 300:../../../src/net/bmac/bmac.c **** 
 301:../../../src/net/bmac/bmac.c **** nrk_sig_t bmac_get_tx_done_signal()
 302:../../../src/net/bmac/bmac.c **** {
 303:../../../src/net/bmac/bmac.c ****    nrk_signal_register(bmac_tx_pkt_done_signal); 
 304:../../../src/net/bmac/bmac.c **** return(bmac_tx_pkt_done_signal);
 305:../../../src/net/bmac/bmac.c **** }
 306:../../../src/net/bmac/bmac.c **** 
 307:../../../src/net/bmac/bmac.c **** 
 308:../../../src/net/bmac/bmac.c **** int8_t bmac_tx_pkt(uint8_t *buf, uint8_t len)
 309:../../../src/net/bmac/bmac.c **** {
 310:../../../src/net/bmac/bmac.c **** uint32_t mask;
 311:../../../src/net/bmac/bmac.c **** if(tx_data_ready==1) return NRK_ERROR;
 312:../../../src/net/bmac/bmac.c **** // If reserve exists check it
 313:../../../src/net/bmac/bmac.c **** #ifdef NRK_MAX_RESERVES
 314:../../../src/net/bmac/bmac.c **** if(tx_reserve!=-1)
 315:../../../src/net/bmac/bmac.c **** 	{
 316:../../../src/net/bmac/bmac.c **** 	if( nrk_reserve_consume(tx_reserve)==NRK_ERROR ) { 
 317:../../../src/net/bmac/bmac.c **** 		return NRK_ERROR;
 318:../../../src/net/bmac/bmac.c **** 		}
 319:../../../src/net/bmac/bmac.c **** 	}
 320:../../../src/net/bmac/bmac.c **** #endif
 321:../../../src/net/bmac/bmac.c **** nrk_signal_register(bmac_tx_pkt_done_signal); 
 322:../../../src/net/bmac/bmac.c **** tx_data_ready=1;
 323:../../../src/net/bmac/bmac.c **** bmac_rfTxInfo.pPayload=buf;
 324:../../../src/net/bmac/bmac.c **** bmac_rfTxInfo.length=len;
 325:../../../src/net/bmac/bmac.c **** #ifdef DEBUG
 326:../../../src/net/bmac/bmac.c **** nrk_kprintf( PSTR("Waiting for tx done signal\r\n"));
 327:../../../src/net/bmac/bmac.c **** #endif
 328:../../../src/net/bmac/bmac.c **** mask=nrk_event_wait (SIG(bmac_tx_pkt_done_signal));
 329:../../../src/net/bmac/bmac.c **** if(mask==0) nrk_kprintf( PSTR("BMAC TX: Error calling event wait\r\n"));
 330:../../../src/net/bmac/bmac.c **** if((mask&SIG(bmac_tx_pkt_done_signal))==0) nrk_kprintf( PSTR("BMAC TX: Woke up on wrong signal\r\n"
 331:../../../src/net/bmac/bmac.c **** if(pkt_got_ack) return NRK_OK;
 332:../../../src/net/bmac/bmac.c **** return NRK_ERROR;
 333:../../../src/net/bmac/bmac.c **** }
 334:../../../src/net/bmac/bmac.c **** 
 335:../../../src/net/bmac/bmac.c **** 
 336:../../../src/net/bmac/bmac.c **** uint8_t *bmac_rx_pkt_get(uint8_t *len, int8_t *rssi)
 337:../../../src/net/bmac/bmac.c **** {
 334               	.LM24:
 335               	.LFBB8:
 336               	/* prologue: function */
 337               	/* frame size = 0 */
 338 005c FC01      		movw r30,r24
 339 005e DB01      		movw r26,r22
 338:../../../src/net/bmac/bmac.c **** 
 339:../../../src/net/bmac/bmac.c ****   if(bmac_rx_pkt_ready()==0) 
 341               	.LM25:
 342 0060 8091 0000 		lds r24,rx_buf_empty
 343 0064 8823      		tst r24
 344 0066 01F0      		breq .L21
 340:../../../src/net/bmac/bmac.c **** 	{
 341:../../../src/net/bmac/bmac.c **** 	*len=0;
 346               	.LM26:
 347 0068 1082      		st Z,__zero_reg__
 342:../../../src/net/bmac/bmac.c **** 	*rssi=0;
 349               	.LM27:
 350 006a 1C92      		st X,__zero_reg__
 351 006c 20E0      		ldi r18,lo8(0)
 352 006e 30E0      		ldi r19,hi8(0)
 343:../../../src/net/bmac/bmac.c **** 	return NULL;
 354               	.LM28:
 355 0070 00C0      		rjmp .L22
 356               	.L21:
 344:../../../src/net/bmac/bmac.c **** 	}
 345:../../../src/net/bmac/bmac.c ****   *len=bmac_rfRxInfo.length;
 358               	.LM29:
 359 0072 8091 0000 		lds r24,bmac_rfRxInfo+3
 360 0076 8083      		st Z,r24
 346:../../../src/net/bmac/bmac.c ****   *rssi=bmac_rfRxInfo.rssi;
 362               	.LM30:
 363 0078 8091 0000 		lds r24,bmac_rfRxInfo+8
 364 007c 8C93      		st X,r24
 347:../../../src/net/bmac/bmac.c ****   return bmac_rfRxInfo.pPayload;
 366               	.LM31:
 367 007e 2091 0000 		lds r18,bmac_rfRxInfo+5
 368 0082 3091 0000 		lds r19,(bmac_rfRxInfo+5)+1
 369               	.L22:
 348:../../../src/net/bmac/bmac.c **** }
 371               	.LM32:
 372 0086 C901      		movw r24,r18
 373               	/* epilogue start */
 374 0088 0895      		ret
 376               	.Lscope8:
 378               		.stabd	78,0,0
 380               	.global	bmac_rx_pkt_ready
 382               	bmac_rx_pkt_ready:
 383               		.stabd	46,0,0
 349:../../../src/net/bmac/bmac.c **** 
 350:../../../src/net/bmac/bmac.c **** int8_t bmac_rx_pkt_ready(void)
 351:../../../src/net/bmac/bmac.c **** {
 385               	.LM33:
 386               	.LFBB9:
 387               	/* prologue: function */
 388               	/* frame size = 0 */
 390               	.LM34:
 391 008a 80E0      		ldi r24,lo8(0)
 392 008c 9091 0000 		lds r25,rx_buf_empty
 393 0090 9923      		tst r25
 394 0092 01F4      		brne .L25
 395 0094 81E0      		ldi r24,lo8(1)
 396               	.L25:
 352:../../../src/net/bmac/bmac.c **** return (!rx_buf_empty);
 353:../../../src/net/bmac/bmac.c **** }
 398               	.LM35:
 399 0096 0895      		ret
 401               	.Lscope9:
 403               		.stabd	78,0,0
 405               	.global	bmac_rx_pkt_release
 407               	bmac_rx_pkt_release:
 408               		.stabd	46,0,0
 354:../../../src/net/bmac/bmac.c **** 
 355:../../../src/net/bmac/bmac.c **** int8_t bmac_rx_pkt_release(void)
 356:../../../src/net/bmac/bmac.c **** {
 410               	.LM36:
 411               	.LFBB10:
 412               	/* prologue: function */
 413               	/* frame size = 0 */
 357:../../../src/net/bmac/bmac.c ****     rx_buf_empty=1;
 415               	.LM37:
 416 0098 81E0      		ldi r24,lo8(1)
 417 009a 8093 0000 		sts rx_buf_empty,r24
 418               	/* epilogue start */
 358:../../../src/net/bmac/bmac.c **** return NRK_OK;
 359:../../../src/net/bmac/bmac.c **** }
 420               	.LM38:
 421 009e 0895      		ret
 423               	.Lscope10:
 425               		.stabd	78,0,0
 428               	.global	bmac_set_rx_check_rate
 430               	bmac_set_rx_check_rate:
 431               		.stabd	46,0,0
 360:../../../src/net/bmac/bmac.c **** 
 361:../../../src/net/bmac/bmac.c **** void bmac_disable()
 362:../../../src/net/bmac/bmac.c **** {
 363:../../../src/net/bmac/bmac.c ****   is_enabled=0;
 364:../../../src/net/bmac/bmac.c ****   rf_power_down();
 365:../../../src/net/bmac/bmac.c **** }
 366:../../../src/net/bmac/bmac.c **** 
 367:../../../src/net/bmac/bmac.c **** void bmac_enable()
 368:../../../src/net/bmac/bmac.c **** {
 369:../../../src/net/bmac/bmac.c ****   is_enabled=1;
 370:../../../src/net/bmac/bmac.c ****   rf_power_up();
 371:../../../src/net/bmac/bmac.c ****   nrk_event_signal (bmac_enable_signal);
 372:../../../src/net/bmac/bmac.c **** }
 373:../../../src/net/bmac/bmac.c **** 
 374:../../../src/net/bmac/bmac.c **** 
 375:../../../src/net/bmac/bmac.c **** void bmac_nw_task ()
 376:../../../src/net/bmac/bmac.c **** {
 377:../../../src/net/bmac/bmac.c **** int8_t v;
 378:../../../src/net/bmac/bmac.c **** int8_t e;
 379:../../../src/net/bmac/bmac.c **** uint8_t backoff;
 380:../../../src/net/bmac/bmac.c **** nrk_sig_mask_t event;
 381:../../../src/net/bmac/bmac.c **** 
 382:../../../src/net/bmac/bmac.c **** while(bmac_started()==0) nrk_wait_until_next_period();
 383:../../../src/net/bmac/bmac.c **** 
 384:../../../src/net/bmac/bmac.c **** //register the signal after bmac_init has been called
 385:../../../src/net/bmac/bmac.c **** v=nrk_signal_register(bmac_enable_signal); 
 386:../../../src/net/bmac/bmac.c **** if(v==NRK_ERROR) nrk_kprintf( PSTR("Failed to register signal\r\n"));
 387:../../../src/net/bmac/bmac.c **** backoff=0;
 388:../../../src/net/bmac/bmac.c ****     while (1) {
 389:../../../src/net/bmac/bmac.c ****     #ifdef NRK_SW_WDT
 390:../../../src/net/bmac/bmac.c **** 	#ifdef BMAC_SW_WDT_ID
 391:../../../src/net/bmac/bmac.c **** 	nrk_sw_wdt_update(BMAC_SW_WDT_ID);
 392:../../../src/net/bmac/bmac.c **** 	#endif
 393:../../../src/net/bmac/bmac.c ****     #endif
 394:../../../src/net/bmac/bmac.c **** 	if(is_enabled ) { 
 395:../../../src/net/bmac/bmac.c **** 	v=1;
 396:../../../src/net/bmac/bmac.c **** 	if(rx_buf_empty==1) v=_bmac_channel_check();
 397:../../../src/net/bmac/bmac.c **** 	// If the buffer is full, signal the receiving task again.
 398:../../../src/net/bmac/bmac.c **** 	else e=nrk_event_signal (bmac_rx_pkt_signal);
 399:../../../src/net/bmac/bmac.c **** 	// bmac_channel check turns on radio, don't turn off if
 400:../../../src/net/bmac/bmac.c **** 	// data is coming.
 401:../../../src/net/bmac/bmac.c **** 		if(v==0)
 402:../../../src/net/bmac/bmac.c **** 			{
 403:../../../src/net/bmac/bmac.c **** 			if(_bmac_rx()==1)
 404:../../../src/net/bmac/bmac.c **** 			  {
 405:../../../src/net/bmac/bmac.c **** 				e=nrk_event_signal (bmac_rx_pkt_signal);
 406:../../../src/net/bmac/bmac.c **** 				//if(e==NRK_ERROR) {
 407:../../../src/net/bmac/bmac.c **** 				//	nrk_kprintf( PSTR("bmac rx pkt signal failed\r\n"));
 408:../../../src/net/bmac/bmac.c **** 				//	printf( "errno: %u \r\n",nrk_errno_get() );
 409:../../../src/net/bmac/bmac.c **** 				//}
 410:../../../src/net/bmac/bmac.c **** 			  }
 411:../../../src/net/bmac/bmac.c **** 			  //else nrk_kprintf( PSTR("Pkt failed, buf could be corrupt\r\n" ));
 412:../../../src/net/bmac/bmac.c **** 			} 
 413:../../../src/net/bmac/bmac.c **** 		if(/*rx_buf_empty==1 &&*/ tx_data_ready==1)
 414:../../../src/net/bmac/bmac.c **** 			{
 415:../../../src/net/bmac/bmac.c **** 				rf_rx_off(); 
 416:../../../src/net/bmac/bmac.c **** 				_bmac_tx();
 417:../../../src/net/bmac/bmac.c **** 			}
 418:../../../src/net/bmac/bmac.c **** 	//do {
 419:../../../src/net/bmac/bmac.c **** 		nrk_wait(_bmac_check_period); 
 420:../../../src/net/bmac/bmac.c **** 	//	if(rx_buf_empty!=1)  nrk_event_signal (bmac_rx_pkt_signal);
 421:../../../src/net/bmac/bmac.c **** 	//} while(rx_buf_empty!=1);
 422:../../../src/net/bmac/bmac.c **** 	} else {
 423:../../../src/net/bmac/bmac.c **** 		event=0;
 424:../../../src/net/bmac/bmac.c **** 		do {
 425:../../../src/net/bmac/bmac.c **** 		v=nrk_signal_register(bmac_enable_signal); 
 426:../../../src/net/bmac/bmac.c ****     		event=nrk_event_wait (SIG(bmac_enable_signal));
 427:../../../src/net/bmac/bmac.c **** 		} while((event & SIG(bmac_enable_signal))==0);
 428:../../../src/net/bmac/bmac.c **** 	}
 429:../../../src/net/bmac/bmac.c **** 	//nrk_wait_until_next_period();
 430:../../../src/net/bmac/bmac.c **** 	}
 431:../../../src/net/bmac/bmac.c **** 
 432:../../../src/net/bmac/bmac.c **** }
 433:../../../src/net/bmac/bmac.c **** 
 434:../../../src/net/bmac/bmac.c **** 
 435:../../../src/net/bmac/bmac.c **** int8_t bmac_set_rx_check_rate(nrk_time_t period)
 436:../../../src/net/bmac/bmac.c **** {
 433               	.LM39:
 434               	.LFBB11:
 435 00a0 DF93      		push r29
 436 00a2 CF93      		push r28
 437 00a4 CDB7      		in r28,__SP_L__
 438 00a6 DEB7      		in r29,__SP_H__
 439 00a8 2897      		sbiw r28,8
 440 00aa 0FB6      		in __tmp_reg__,__SREG__
 441 00ac F894      		cli
 442 00ae DEBF      		out __SP_H__,r29
 443 00b0 0FBE      		out __SREG__,__tmp_reg__
 444 00b2 CDBF      		out __SP_L__,r28
 445               	/* prologue: function */
 446               	/* frame size = 8 */
 447 00b4 2983      		std Y+1,r18
 448 00b6 3A83      		std Y+2,r19
 449 00b8 4B83      		std Y+3,r20
 450 00ba 5C83      		std Y+4,r21
 451 00bc 6D83      		std Y+5,r22
 452 00be 7E83      		std Y+6,r23
 453 00c0 8F83      		std Y+7,r24
 454 00c2 9887      		std Y+8,r25
 456               	.LM40:
 457 00c4 2981      		ldd r18,Y+1
 458 00c6 3A81      		ldd r19,Y+2
 459 00c8 4B81      		ldd r20,Y+3
 460 00ca 5C81      		ldd r21,Y+4
 461 00cc 8D81      		ldd r24,Y+5
 462 00ce 9E81      		ldd r25,Y+6
 463 00d0 AF81      		ldd r26,Y+7
 464 00d2 B885      		ldd r27,Y+8
 437:../../../src/net/bmac/bmac.c **** if(period.secs==0 && period.nano_secs < BMAC_MIN_CHECK_RATE_MS*NANOS_PER_MS)
 466               	.LM41:
 467 00d4 2115      		cp r18,__zero_reg__
 468 00d6 3105      		cpc r19,__zero_reg__
 469 00d8 4105      		cpc r20,__zero_reg__
 470 00da 5105      		cpc r21,__zero_reg__
 471 00dc 01F4      		brne .L30
 472 00de 8030      		cpi r24,lo8(20000000)
 473 00e0 6DE2      		ldi r22,hi8(20000000)
 474 00e2 9607      		cpc r25,r22
 475 00e4 61E3      		ldi r22,hlo8(20000000)
 476 00e6 A607      		cpc r26,r22
 477 00e8 61E0      		ldi r22,hhi8(20000000)
 478 00ea B607      		cpc r27,r22
 479 00ec 00F4      		brsh .L30
 480 00ee 8FEF      		ldi r24,lo8(-1)
 481 00f0 00C0      		rjmp .L31
 482               	.L30:
 438:../../../src/net/bmac/bmac.c **** 	return NRK_ERROR;
 439:../../../src/net/bmac/bmac.c **** _bmac_check_period.secs=period.secs;
 484               	.LM42:
 485 00f2 2093 0000 		sts _bmac_check_period,r18
 486 00f6 3093 0000 		sts (_bmac_check_period)+1,r19
 487 00fa 4093 0000 		sts (_bmac_check_period)+2,r20
 488 00fe 5093 0000 		sts (_bmac_check_period)+3,r21
 440:../../../src/net/bmac/bmac.c **** _bmac_check_period.nano_secs=period.nano_secs;
 490               	.LM43:
 491 0102 8093 0000 		sts _bmac_check_period+4,r24
 492 0106 9093 0000 		sts (_bmac_check_period+4)+1,r25
 493 010a A093 0000 		sts (_bmac_check_period+4)+2,r26
 494 010e B093 0000 		sts (_bmac_check_period+4)+3,r27
 495 0112 81E0      		ldi r24,lo8(1)
 496               	.L31:
 497               	/* epilogue start */
 441:../../../src/net/bmac/bmac.c **** return NRK_OK;
 442:../../../src/net/bmac/bmac.c **** }
 499               	.LM44:
 500 0114 2896      		adiw r28,8
 501 0116 0FB6      		in __tmp_reg__,__SREG__
 502 0118 F894      		cli
 503 011a DEBF      		out __SP_H__,r29
 504 011c 0FBE      		out __SREG__,__tmp_reg__
 505 011e CDBF      		out __SP_L__,r28
 506 0120 CF91      		pop r28
 507 0122 DF91      		pop r29
 508 0124 0895      		ret
 510               	.Lscope11:
 512               		.stabd	78,0,0
 514               	.global	bmac_started
 516               	bmac_started:
 517               		.stabd	46,0,0
 443:../../../src/net/bmac/bmac.c **** 
 444:../../../src/net/bmac/bmac.c **** int8_t bmac_started()
 445:../../../src/net/bmac/bmac.c **** {
 519               	.LM45:
 520               	.LFBB12:
 521               	/* prologue: function */
 522               	/* frame size = 0 */
 446:../../../src/net/bmac/bmac.c **** return bmac_running;
 447:../../../src/net/bmac/bmac.c **** }
 524               	.LM46:
 525 0126 8091 0000 		lds r24,bmac_running
 526               	/* epilogue start */
 527 012a 0895      		ret
 529               	.Lscope12:
 531               		.stabd	78,0,0
 533               	.global	bmac_rx_failure_count_get
 535               	bmac_rx_failure_count_get:
 536               		.stabd	46,0,0
 448:../../../src/net/bmac/bmac.c **** 
 449:../../../src/net/bmac/bmac.c **** int8_t _bmac_channel_check()
 450:../../../src/net/bmac/bmac.c **** {
 451:../../../src/net/bmac/bmac.c **** int8_t val;
 452:../../../src/net/bmac/bmac.c **** rf_polling_rx_on();
 453:../../../src/net/bmac/bmac.c **** nrk_spin_wait_us(250);
 454:../../../src/net/bmac/bmac.c **** val=CCA_IS_1;
 455:../../../src/net/bmac/bmac.c **** if(val) rf_rx_off(); 
 456:../../../src/net/bmac/bmac.c **** return val;
 457:../../../src/net/bmac/bmac.c **** 
 458:../../../src/net/bmac/bmac.c **** }
 459:../../../src/net/bmac/bmac.c **** 
 460:../../../src/net/bmac/bmac.c **** int8_t _bmac_rx()
 461:../../../src/net/bmac/bmac.c **** {
 462:../../../src/net/bmac/bmac.c **** int8_t n;
 463:../../../src/net/bmac/bmac.c **** uint8_t cnt;
 464:../../../src/net/bmac/bmac.c **** 
 465:../../../src/net/bmac/bmac.c **** 	rf_set_rx (&bmac_rfRxInfo, g_chan);
 466:../../../src/net/bmac/bmac.c ****         rf_polling_rx_on ();
 467:../../../src/net/bmac/bmac.c **** 	cnt=0;
 468:../../../src/net/bmac/bmac.c **** 	while ((n = rf_rx_check_fifop()) == 0)
 469:../../../src/net/bmac/bmac.c **** 	{
 470:../../../src/net/bmac/bmac.c **** 	cnt++;
 471:../../../src/net/bmac/bmac.c **** 	nrk_wait(_bmac_check_period);
 472:../../../src/net/bmac/bmac.c **** 	if(cnt>2) { 
 473:../../../src/net/bmac/bmac.c **** 			#ifdef DEBUG
 474:../../../src/net/bmac/bmac.c **** 			printf( "rx timeout 1 %d\r\n",cnt );
 475:../../../src/net/bmac/bmac.c **** 			#endif
 476:../../../src/net/bmac/bmac.c **** 			if(rx_failure_cnt<65535) rx_failure_cnt++;
 477:../../../src/net/bmac/bmac.c **** 			rf_rx_off();
 478:../../../src/net/bmac/bmac.c **** 			return 0;
 479:../../../src/net/bmac/bmac.c **** 			} 
 480:../../../src/net/bmac/bmac.c **** 	}
 481:../../../src/net/bmac/bmac.c ****         if (n != 0) {
 482:../../../src/net/bmac/bmac.c ****                 n = 0;
 483:../../../src/net/bmac/bmac.c ****                 // Packet on its way
 484:../../../src/net/bmac/bmac.c ****                 cnt=0;
 485:../../../src/net/bmac/bmac.c ****                 while ((n = rf_polling_rx_packet ()) == 0) {
 486:../../../src/net/bmac/bmac.c ****                 cnt++;
 487:../../../src/net/bmac/bmac.c ****                 nrk_spin_wait_us(100);
 488:../../../src/net/bmac/bmac.c ****                 if (cnt > 50) { 
 489:../../../src/net/bmac/bmac.c **** 			#ifdef DEBUG
 490:../../../src/net/bmac/bmac.c **** 			printf( "rx timeout 2\r\n" ); 
 491:../../../src/net/bmac/bmac.c **** 			#endif
 492:../../../src/net/bmac/bmac.c **** 			rx_failure_cnt++;
 493:../../../src/net/bmac/bmac.c **** 			rf_rx_off(); 
 494:../../../src/net/bmac/bmac.c **** 			return 0;
 495:../../../src/net/bmac/bmac.c **** 			}        
 496:../../../src/net/bmac/bmac.c ****                 }
 497:../../../src/net/bmac/bmac.c ****         }
 498:../../../src/net/bmac/bmac.c ****         rf_rx_off();
 499:../../../src/net/bmac/bmac.c ****         if (n == 1) {
 500:../../../src/net/bmac/bmac.c ****                 // CRC and checksum passed
 501:../../../src/net/bmac/bmac.c ****     		rx_buf_empty=0;
 502:../../../src/net/bmac/bmac.c **** 		#ifdef DEBUG
 503:../../../src/net/bmac/bmac.c ****                 printf( "BMAC: SNR= %d [",bmac_rfRxInfo.rssi );
 504:../../../src/net/bmac/bmac.c ****                 for(uint8_t i=0; i<bmac_rfRxInfo.length; i++ )
 505:../../../src/net/bmac/bmac.c ****                         printf( "%c", bmac_rfRxInfo.pPayload[i]);
 506:../../../src/net/bmac/bmac.c ****                 printf( "]\r\n" );
 507:../../../src/net/bmac/bmac.c **** 		#endif
 508:../../../src/net/bmac/bmac.c **** 		return 1;
 509:../../../src/net/bmac/bmac.c ****         } else 
 510:../../../src/net/bmac/bmac.c **** 	{
 511:../../../src/net/bmac/bmac.c **** 	#ifdef DEBUG 
 512:../../../src/net/bmac/bmac.c **** 	printf( "CRC failed!\r\n" );
 513:../../../src/net/bmac/bmac.c **** 	#endif 
 514:../../../src/net/bmac/bmac.c **** 	rx_failure_cnt++;
 515:../../../src/net/bmac/bmac.c **** 	return 0; 
 516:../../../src/net/bmac/bmac.c **** 	}
 517:../../../src/net/bmac/bmac.c **** rx_failure_cnt++;
 518:../../../src/net/bmac/bmac.c **** return 0;
 519:../../../src/net/bmac/bmac.c **** }
 520:../../../src/net/bmac/bmac.c **** 
 521:../../../src/net/bmac/bmac.c **** 
 522:../../../src/net/bmac/bmac.c **** uint16_t bmac_rx_failure_count_get()
 523:../../../src/net/bmac/bmac.c **** {
 538               	.LM47:
 539               	.LFBB13:
 540               	/* prologue: function */
 541               	/* frame size = 0 */
 524:../../../src/net/bmac/bmac.c ****   return rx_failure_cnt;
 525:../../../src/net/bmac/bmac.c **** }
 543               	.LM48:
 544 012c 8091 0000 		lds r24,rx_failure_cnt
 545 0130 9091 0000 		lds r25,rx_failure_cnt+1
 546               	/* epilogue start */
 547 0134 0895      		ret
 549               	.Lscope13:
 551               		.stabd	78,0,0
 553               	.global	bmac_rx_failure_count_reset
 555               	bmac_rx_failure_count_reset:
 556               		.stabd	46,0,0
 526:../../../src/net/bmac/bmac.c **** 
 527:../../../src/net/bmac/bmac.c **** uint8_t bmac_rx_failure_count_reset()
 528:../../../src/net/bmac/bmac.c **** {
 558               	.LM49:
 559               	.LFBB14:
 560               	/* prologue: function */
 561               	/* frame size = 0 */
 529:../../../src/net/bmac/bmac.c ****   rx_failure_cnt=0;
 563               	.LM50:
 564 0136 1092 0000 		sts rx_failure_cnt,__zero_reg__
 565 013a 1092 0000 		sts (rx_failure_cnt)+1,__zero_reg__
 566 013e 1092 0000 		sts (rx_failure_cnt)+2,__zero_reg__
 567 0142 1092 0000 		sts (rx_failure_cnt)+3,__zero_reg__
 530:../../../src/net/bmac/bmac.c **** return NRK_OK;
 531:../../../src/net/bmac/bmac.c **** }
 569               	.LM51:
 570 0146 81E0      		ldi r24,lo8(1)
 571               	/* epilogue start */
 572 0148 0895      		ret
 574               	.Lscope14:
 576               		.stabd	78,0,0
 579               	.global	_b_pow
 581               	_b_pow:
 582               		.stabd	46,0,0
 532:../../../src/net/bmac/bmac.c **** 
 533:../../../src/net/bmac/bmac.c **** int8_t _bmac_tx()
 534:../../../src/net/bmac/bmac.c **** {
 535:../../../src/net/bmac/bmac.c **** uint8_t v,backoff, backoff_count;
 536:../../../src/net/bmac/bmac.c **** uint16_t b;
 537:../../../src/net/bmac/bmac.c **** 
 538:../../../src/net/bmac/bmac.c **** #ifdef DEBUG
 539:../../../src/net/bmac/bmac.c **** nrk_kprintf( PSTR("_bmac_tx()\r\n"));
 540:../../../src/net/bmac/bmac.c **** #endif
 541:../../../src/net/bmac/bmac.c **** if(cca_active)
 542:../../../src/net/bmac/bmac.c **** {
 543:../../../src/net/bmac/bmac.c **** 
 544:../../../src/net/bmac/bmac.c **** // Add random time here to stop nodes from synchronizing with eachother
 545:../../../src/net/bmac/bmac.c **** b=_nrk_time_to_ticks(&_bmac_check_period);
 546:../../../src/net/bmac/bmac.c **** b=b/((rand()%10)+1);
 547:../../../src/net/bmac/bmac.c **** //printf( "waiting %d\r\n",b );
 548:../../../src/net/bmac/bmac.c **** nrk_wait_until_ticks(b);
 549:../../../src/net/bmac/bmac.c **** //nrk_wait_ticks(b);
 550:../../../src/net/bmac/bmac.c **** 
 551:../../../src/net/bmac/bmac.c **** 	backoff_count=1;
 552:../../../src/net/bmac/bmac.c **** 	do{
 553:../../../src/net/bmac/bmac.c **** 	v=_bmac_channel_check();
 554:../../../src/net/bmac/bmac.c **** 	rf_rx_off(); 
 555:../../../src/net/bmac/bmac.c **** 	if(v==1) break;
 556:../../../src/net/bmac/bmac.c **** 	// Channel is busy
 557:../../../src/net/bmac/bmac.c **** 	backoff=rand()%(_b_pow(backoff_count));
 558:../../../src/net/bmac/bmac.c **** 			#ifdef DEBUG
 559:../../../src/net/bmac/bmac.c **** 			printf( "backoff %d\r\n",backoff );
 560:../../../src/net/bmac/bmac.c **** 			#endif
 561:../../../src/net/bmac/bmac.c **** //	printf( "backoff %d\r\n",backoff );
 562:../../../src/net/bmac/bmac.c **** 	nrk_wait_until_next_n_periods(backoff);
 563:../../../src/net/bmac/bmac.c **** 	backoff_count++;
 564:../../../src/net/bmac/bmac.c **** 	if(backoff_count>6) backoff_count=6; // cap it at 64	
 565:../../../src/net/bmac/bmac.c **** 	b=_nrk_time_to_ticks(&_bmac_check_period);
 566:../../../src/net/bmac/bmac.c **** 	b=b/((rand()%10)+1);
 567:../../../src/net/bmac/bmac.c **** //	printf( "waiting %d\r\n",b );
 568:../../../src/net/bmac/bmac.c **** 	nrk_wait_until_ticks(b);
 569:../../../src/net/bmac/bmac.c **** //	nrk_wait_ticks(b);
 570:../../../src/net/bmac/bmac.c **** 
 571:../../../src/net/bmac/bmac.c **** 	} while(v==0);
 572:../../../src/net/bmac/bmac.c **** }
 573:../../../src/net/bmac/bmac.c **** 
 574:../../../src/net/bmac/bmac.c **** 	rf_test_mode();
 575:../../../src/net/bmac/bmac.c **** 	rf_carrier_on(); 
 576:../../../src/net/bmac/bmac.c **** 	nrk_wait(_bmac_check_period);
 577:../../../src/net/bmac/bmac.c **** 	//nrk_wait_until_next_period();
 578:../../../src/net/bmac/bmac.c **** 	rf_carrier_off(); 
 579:../../../src/net/bmac/bmac.c **** 	rf_data_mode();
 580:../../../src/net/bmac/bmac.c **** 	// send packet
 581:../../../src/net/bmac/bmac.c **** 	rf_rx_off();
 582:../../../src/net/bmac/bmac.c **** 	pkt_got_ack=rf_tx_packet (&bmac_rfTxInfo);
 583:../../../src/net/bmac/bmac.c **** 	rf_rx_off(); 	
 584:../../../src/net/bmac/bmac.c **** tx_data_ready=0;
 585:../../../src/net/bmac/bmac.c **** nrk_event_signal (bmac_tx_pkt_done_signal);
 586:../../../src/net/bmac/bmac.c **** return NRK_OK;
 587:../../../src/net/bmac/bmac.c **** }
 588:../../../src/net/bmac/bmac.c **** 
 589:../../../src/net/bmac/bmac.c **** uint8_t _b_pow(uint8_t in)
 590:../../../src/net/bmac/bmac.c **** {
 584               	.LM52:
 585               	.LFBB15:
 586               	/* prologue: function */
 587               	/* frame size = 0 */
 588 014a 982F      		mov r25,r24
 591:../../../src/net/bmac/bmac.c **** uint8_t i;
 592:../../../src/net/bmac/bmac.c **** uint8_t result;
 593:../../../src/net/bmac/bmac.c **** if(in<=1) return 1;
 590               	.LM53:
 591 014c 8230      		cpi r24,lo8(2)
 592 014e 00F4      		brsh .L40
 593 0150 81E0      		ldi r24,lo8(1)
 594 0152 0895      		ret
 595               	.L40:
 594:../../../src/net/bmac/bmac.c **** if(in>7) in=6; // cap it at 128 
 597               	.LM54:
 598 0154 8830      		cpi r24,lo8(8)
 599 0156 00F0      		brlo .L42
 600 0158 96E0      		ldi r25,lo8(6)
 601               	.L42:
 602 015a 20E0      		ldi r18,lo8(0)
 603 015c 81E0      		ldi r24,lo8(1)
 604               	.L43:
 595:../../../src/net/bmac/bmac.c **** result=1;
 596:../../../src/net/bmac/bmac.c **** for(i=0; i<in; i++ )
 597:../../../src/net/bmac/bmac.c ****   result=result*2;
 606               	.LM55:
 607 015e 880F      		lsl r24
 609               	.LM56:
 610 0160 2F5F      		subi r18,lo8(-(1))
 611 0162 2917      		cp r18,r25
 612 0164 00F0      		brlo .L43
 598:../../../src/net/bmac/bmac.c **** return result;
 599:../../../src/net/bmac/bmac.c **** }
 614               	.LM57:
 615 0166 0895      		ret
 621               	.Lscope15:
 623               		.stabd	78,0,0
 625               	.global	bmac_task_config
 627               	bmac_task_config:
 628               		.stabd	46,0,0
 600:../../../src/net/bmac/bmac.c **** 
 601:../../../src/net/bmac/bmac.c **** 
 602:../../../src/net/bmac/bmac.c **** void bmac_task_config ()
 603:../../../src/net/bmac/bmac.c **** {
 630               	.LM58:
 631               	.LFBB16:
 632 0168 CF93      		push r28
 633 016a DF93      		push r29
 634               	/* prologue: function */
 635               	/* frame size = 0 */
 604:../../../src/net/bmac/bmac.c ****     nrk_task_set_entry_function( &bmac_task, bmac_nw_task);
 637               	.LM59:
 638 016c C0E0      		ldi r28,lo8(bmac_task)
 639 016e D0E0      		ldi r29,hi8(bmac_task)
 640 0170 CE01      		movw r24,r28
 641 0172 60E0      		ldi r22,lo8(gs(bmac_nw_task))
 642 0174 70E0      		ldi r23,hi8(gs(bmac_nw_task))
 643 0176 0E94 0000 		call nrk_task_set_entry_function
 605:../../../src/net/bmac/bmac.c ****     nrk_task_set_stk( &bmac_task, bmac_task_stack, BMAC_STACKSIZE);
 645               	.LM60:
 646 017a CE01      		movw r24,r28
 647 017c 60E0      		ldi r22,lo8(bmac_task_stack)
 648 017e 70E0      		ldi r23,hi8(bmac_task_stack)
 649 0180 40E8      		ldi r20,lo8(128)
 650 0182 50E0      		ldi r21,hi8(128)
 651 0184 0E94 0000 		call nrk_task_set_stk
 606:../../../src/net/bmac/bmac.c ****     bmac_task.prio = BMAC_TASK_PRIORITY;
 653               	.LM61:
 654 0188 84E1      		ldi r24,lo8(20)
 655 018a 8093 0000 		sts bmac_task+8,r24
 607:../../../src/net/bmac/bmac.c ****     bmac_task.FirstActivation = TRUE;
 657               	.LM62:
 658 018e 81E0      		ldi r24,lo8(1)
 659 0190 8093 0000 		sts bmac_task+7,r24
 608:../../../src/net/bmac/bmac.c ****     bmac_task.Type = BASIC_TASK;
 661               	.LM63:
 662 0194 8093 0000 		sts bmac_task+9,r24
 609:../../../src/net/bmac/bmac.c ****     bmac_task.SchType = PREEMPTIVE;
 664               	.LM64:
 665 0198 8093 0000 		sts bmac_task+10,r24
 610:../../../src/net/bmac/bmac.c ****     bmac_task.period.secs = 0;
 667               	.LM65:
 668 019c 1092 0000 		sts bmac_task+11,__zero_reg__
 669 01a0 1092 0000 		sts (bmac_task+11)+1,__zero_reg__
 670 01a4 1092 0000 		sts (bmac_task+11)+2,__zero_reg__
 671 01a8 1092 0000 		sts (bmac_task+11)+3,__zero_reg__
 611:../../../src/net/bmac/bmac.c ****     bmac_task.period.nano_secs = BMAC_MIN_CHECK_RATE_MS * NANOS_PER_MS;
 673               	.LM66:
 674 01ac 80E0      		ldi r24,lo8(20000000)
 675 01ae 9DE2      		ldi r25,hi8(20000000)
 676 01b0 A1E3      		ldi r26,hlo8(20000000)
 677 01b2 B1E0      		ldi r27,hhi8(20000000)
 678 01b4 8093 0000 		sts bmac_task+15,r24
 679 01b8 9093 0000 		sts (bmac_task+15)+1,r25
 680 01bc A093 0000 		sts (bmac_task+15)+2,r26
 681 01c0 B093 0000 		sts (bmac_task+15)+3,r27
 612:../../../src/net/bmac/bmac.c ****     bmac_task.cpu_reserve.secs = 5;      // bmac reserve , 0 to disable
 683               	.LM67:
 684 01c4 85E0      		ldi r24,lo8(5)
 685 01c6 90E0      		ldi r25,hi8(5)
 686 01c8 A0E0      		ldi r26,hlo8(5)
 687 01ca B0E0      		ldi r27,hhi8(5)
 688 01cc 8093 0000 		sts bmac_task+19,r24
 689 01d0 9093 0000 		sts (bmac_task+19)+1,r25
 690 01d4 A093 0000 		sts (bmac_task+19)+2,r26
 691 01d8 B093 0000 		sts (bmac_task+19)+3,r27
 613:../../../src/net/bmac/bmac.c ****     bmac_task.cpu_reserve.nano_secs = 0;
 693               	.LM68:
 694 01dc 1092 0000 		sts bmac_task+23,__zero_reg__
 695 01e0 1092 0000 		sts (bmac_task+23)+1,__zero_reg__
 696 01e4 1092 0000 		sts (bmac_task+23)+2,__zero_reg__
 697 01e8 1092 0000 		sts (bmac_task+23)+3,__zero_reg__
 614:../../../src/net/bmac/bmac.c ****     bmac_task.offset.secs = 0;
 699               	.LM69:
 700 01ec 1092 0000 		sts bmac_task+27,__zero_reg__
 701 01f0 1092 0000 		sts (bmac_task+27)+1,__zero_reg__
 702 01f4 1092 0000 		sts (bmac_task+27)+2,__zero_reg__
 703 01f8 1092 0000 		sts (bmac_task+27)+3,__zero_reg__
 615:../../../src/net/bmac/bmac.c ****     bmac_task.offset.nano_secs = 0;
 705               	.LM70:
 706 01fc 1092 0000 		sts bmac_task+31,__zero_reg__
 707 0200 1092 0000 		sts (bmac_task+31)+1,__zero_reg__
 708 0204 1092 0000 		sts (bmac_task+31)+2,__zero_reg__
 709 0208 1092 0000 		sts (bmac_task+31)+3,__zero_reg__
 616:../../../src/net/bmac/bmac.c ****     #ifdef DEBUG
 617:../../../src/net/bmac/bmac.c ****     printf( "bmac activate\r\n" );
 618:../../../src/net/bmac/bmac.c ****     #endif 
 619:../../../src/net/bmac/bmac.c ****     nrk_activate_task (&bmac_task);
 711               	.LM71:
 712 020c CE01      		movw r24,r28
 713 020e 0E94 0000 		call nrk_activate_task
 714               	/* epilogue start */
 620:../../../src/net/bmac/bmac.c **** }
 716               	.LM72:
 717 0212 DF91      		pop r29
 718 0214 CF91      		pop r28
 719 0216 0895      		ret
 721               	.Lscope16:
 723               		.stabd	78,0,0
 725               	.global	_bmac_channel_check
 727               	_bmac_channel_check:
 728               		.stabd	46,0,0
 730               	.LM73:
 731               	.LFBB17:
 732 0218 DF93      		push r29
 733 021a CF93      		push r28
 734 021c 0F92      		push __tmp_reg__
 735 021e CDB7      		in r28,__SP_L__
 736 0220 DEB7      		in r29,__SP_H__
 737               	/* prologue: function */
 738               	/* frame size = 1 */
 740               	.LM74:
 741 0222 0E94 0000 		call rf_polling_rx_on
 743               	.LM75:
 744 0226 8AEF      		ldi r24,lo8(250)
 745 0228 90E0      		ldi r25,hi8(250)
 746 022a 0E94 0000 		call nrk_spin_wait_us
 748               	.LM76:
 749 022e 20B3      		in r18,48-0x20
 750 0230 30E0      		ldi r19,lo8(0)
 751 0232 86E0      		ldi r24,6
 752 0234 3695      	1:	lsr r19
 753 0236 2795      		ror r18
 754 0238 8A95      		dec r24
 755 023a 01F4      		brne 1b
 757               	.LM77:
 758 023c 822F      		mov r24,r18
 759 023e 8170      		andi r24,lo8(1)
 760 0240 20FF      		sbrs r18,0
 761 0242 00C0      		rjmp .L49
 762 0244 8983      		std Y+1,r24
 763 0246 0E94 0000 		call rf_rx_off
 764 024a 8981      		ldd r24,Y+1
 765               	.L49:
 766               	/* epilogue start */
 768               	.LM78:
 769 024c 0F90      		pop __tmp_reg__
 770 024e CF91      		pop r28
 771 0250 DF91      		pop r29
 772 0252 0895      		ret
 777               	.Lscope17:
 779               		.stabd	78,0,0
 781               	.global	_bmac_tx
 783               	_bmac_tx:
 784               		.stabd	46,0,0
 786               	.LM79:
 787               	.LFBB18:
 788 0254 0F93      		push r16
 789 0256 1F93      		push r17
 790 0258 CF93      		push r28
 791 025a DF93      		push r29
 792               	/* prologue: function */
 793               	/* frame size = 0 */
 795               	.LM80:
 796 025c 8091 0000 		lds r24,cca_active
 797 0260 8823      		tst r24
 798 0262 01F4      		brne .+2
 799 0264 00C0      		rjmp .L52
 801               	.LM81:
 802 0266 80E0      		ldi r24,lo8(_bmac_check_period)
 803 0268 90E0      		ldi r25,hi8(_bmac_check_period)
 804 026a 0E94 0000 		call _nrk_time_to_ticks
 805 026e 8C01      		movw r16,r24
 807               	.LM82:
 808 0270 0E94 0000 		call rand
 810               	.LM83:
 811 0274 6AE0      		ldi r22,lo8(10)
 812 0276 70E0      		ldi r23,hi8(10)
 813 0278 0E94 0000 		call __divmodhi4
 814 027c BC01      		movw r22,r24
 815 027e 6F5F      		subi r22,lo8(-(1))
 816 0280 7F4F      		sbci r23,hi8(-(1))
 817 0282 C801      		movw r24,r16
 818 0284 0E94 0000 		call __udivmodhi4
 819 0288 CB01      		movw r24,r22
 820 028a 0E94 0000 		call nrk_wait_until_ticks
 821 028e 11E0      		ldi r17,lo8(1)
 822               	.L58:
 824               	.LM84:
 825 0290 0E94 0000 		call _bmac_channel_check
 826 0294 082F      		mov r16,r24
 828               	.LM85:
 829 0296 0E94 0000 		call rf_rx_off
 831               	.LM86:
 832 029a 0130      		cpi r16,lo8(1)
 833 029c 01F0      		breq .L52
 835               	.LM87:
 836 029e 0E94 0000 		call rand
 837 02a2 EC01      		movw r28,r24
 838 02a4 812F      		mov r24,r17
 839 02a6 0E94 0000 		call _b_pow
 840 02aa 682F      		mov r22,r24
 842               	.LM88:
 843 02ac CE01      		movw r24,r28
 844 02ae 70E0      		ldi r23,lo8(0)
 845 02b0 0E94 0000 		call __divmodhi4
 846 02b4 90E0      		ldi r25,lo8(0)
 847 02b6 0E94 0000 		call nrk_wait_until_next_n_periods
 849               	.LM89:
 850 02ba 80E0      		ldi r24,lo8(_bmac_check_period)
 851 02bc 90E0      		ldi r25,hi8(_bmac_check_period)
 852 02be 0E94 0000 		call _nrk_time_to_ticks
 853 02c2 EC01      		movw r28,r24
 855               	.LM90:
 856 02c4 0E94 0000 		call rand
 858               	.LM91:
 859 02c8 6AE0      		ldi r22,lo8(10)
 860 02ca 70E0      		ldi r23,hi8(10)
 861 02cc 0E94 0000 		call __divmodhi4
 862 02d0 BC01      		movw r22,r24
 863 02d2 6F5F      		subi r22,lo8(-(1))
 864 02d4 7F4F      		sbci r23,hi8(-(1))
 865 02d6 CE01      		movw r24,r28
 866 02d8 0E94 0000 		call __udivmodhi4
 867 02dc CB01      		movw r24,r22
 868 02de 0E94 0000 		call nrk_wait_until_ticks
 870               	.LM92:
 871 02e2 0023      		tst r16
 872 02e4 01F4      		brne .L52
 874               	.LM93:
 875 02e6 1F5F      		subi r17,lo8(-(1))
 876 02e8 1730      		cpi r17,lo8(7)
 877 02ea 00F0      		brlo .L58
 878 02ec 16E0      		ldi r17,lo8(6)
 879 02ee 00C0      		rjmp .L58
 880               	.L52:
 882               	.LM94:
 883 02f0 0E94 0000 		call rf_test_mode
 885               	.LM95:
 886 02f4 0E94 0000 		call rf_carrier_on
 888               	.LM96:
 889 02f8 2091 0000 		lds r18,_bmac_check_period
 890 02fc 3091 0000 		lds r19,_bmac_check_period+1
 891 0300 4091 0000 		lds r20,_bmac_check_period+2
 892 0304 5091 0000 		lds r21,_bmac_check_period+3
 893 0308 6091 0000 		lds r22,_bmac_check_period+4
 894 030c 7091 0000 		lds r23,_bmac_check_period+5
 895 0310 8091 0000 		lds r24,_bmac_check_period+6
 896 0314 9091 0000 		lds r25,_bmac_check_period+7
 897 0318 0E94 0000 		call nrk_wait
 899               	.LM97:
 900 031c 0E94 0000 		call rf_carrier_off
 902               	.LM98:
 903 0320 0E94 0000 		call rf_data_mode
 905               	.LM99:
 906 0324 0E94 0000 		call rf_rx_off
 908               	.LM100:
 909 0328 80E0      		ldi r24,lo8(bmac_rfTxInfo)
 910 032a 90E0      		ldi r25,hi8(bmac_rfTxInfo)
 911 032c 0E94 0000 		call rf_tx_packet
 912 0330 8093 0000 		sts pkt_got_ack,r24
 914               	.LM101:
 915 0334 0E94 0000 		call rf_rx_off
 917               	.LM102:
 918 0338 1092 0000 		sts tx_data_ready,__zero_reg__
 920               	.LM103:
 921 033c 8091 0000 		lds r24,bmac_tx_pkt_done_signal
 922 0340 0E94 0000 		call nrk_event_signal
 924               	.LM104:
 925 0344 81E0      		ldi r24,lo8(1)
 926               	/* epilogue start */
 927 0346 DF91      		pop r29
 928 0348 CF91      		pop r28
 929 034a 1F91      		pop r17
 930 034c 0F91      		pop r16
 931 034e 0895      		ret
 937               	.Lscope18:
 939               		.stabd	78,0,0
 941               	.global	_bmac_rx
 943               	_bmac_rx:
 944               		.stabd	46,0,0
 946               	.LM105:
 947               	.LFBB19:
 948 0350 1F93      		push r17
 949 0352 DF93      		push r29
 950 0354 CF93      		push r28
 951 0356 0F92      		push __tmp_reg__
 952 0358 CDB7      		in r28,__SP_L__
 953 035a DEB7      		in r29,__SP_H__
 954               	/* prologue: function */
 955               	/* frame size = 1 */
 957               	.LM106:
 958 035c 80E0      		ldi r24,lo8(bmac_rfRxInfo)
 959 035e 90E0      		ldi r25,hi8(bmac_rfRxInfo)
 960 0360 6091 0000 		lds r22,g_chan
 961 0364 0E94 0000 		call rf_set_rx
 963               	.LM107:
 964 0368 0E94 0000 		call rf_polling_rx_on
 965 036c 10E0      		ldi r17,lo8(0)
 967               	.LM108:
 968 036e 00C0      		rjmp .L60
 969               	.L63:
 971               	.LM109:
 972 0370 1F5F      		subi r17,lo8(-(1))
 974               	.LM110:
 975 0372 2091 0000 		lds r18,_bmac_check_period
 976 0376 3091 0000 		lds r19,_bmac_check_period+1
 977 037a 4091 0000 		lds r20,_bmac_check_period+2
 978 037e 5091 0000 		lds r21,_bmac_check_period+3
 979 0382 6091 0000 		lds r22,_bmac_check_period+4
 980 0386 7091 0000 		lds r23,_bmac_check_period+5
 981 038a 8091 0000 		lds r24,_bmac_check_period+6
 982 038e 9091 0000 		lds r25,_bmac_check_period+7
 983 0392 0E94 0000 		call nrk_wait
 985               	.LM111:
 986 0396 1330      		cpi r17,lo8(3)
 987 0398 01F4      		brne .L60
 989               	.LM112:
 990 039a 8091 0000 		lds r24,rx_failure_cnt
 991 039e 9091 0000 		lds r25,(rx_failure_cnt)+1
 992 03a2 A091 0000 		lds r26,(rx_failure_cnt)+2
 993 03a6 B091 0000 		lds r27,(rx_failure_cnt)+3
 994 03aa 8F3F      		cpi r24,lo8(65535)
 995 03ac 2FEF      		ldi r18,hi8(65535)
 996 03ae 9207      		cpc r25,r18
 997 03b0 20E0      		ldi r18,hlo8(65535)
 998 03b2 A207      		cpc r26,r18
 999 03b4 20E0      		ldi r18,hhi8(65535)
 1000 03b6 B207      		cpc r27,r18
 1001 03b8 00F0      		brlo .L74
 1002 03ba 00C0      		rjmp .L73
 1003               	.L60:
 1005               	.LM113:
 1006 03bc 0E94 0000 		call rf_rx_check_fifop
 1007 03c0 8823      		tst r24
 1008 03c2 01F0      		breq .L63
 1009 03c4 00C0      		rjmp .L76
 1010               	.L66:
 1012               	.LM114:
 1013 03c6 1F5F      		subi r17,lo8(-(1))
 1015               	.LM115:
 1016 03c8 84E6      		ldi r24,lo8(100)
 1017 03ca 90E0      		ldi r25,hi8(100)
 1018 03cc 0E94 0000 		call nrk_spin_wait_us
 1020               	.LM116:
 1021 03d0 1333      		cpi r17,lo8(51)
 1022 03d2 01F4      		brne .L65
 1024               	.LM117:
 1025 03d4 8091 0000 		lds r24,rx_failure_cnt
 1026 03d8 9091 0000 		lds r25,(rx_failure_cnt)+1
 1027 03dc A091 0000 		lds r26,(rx_failure_cnt)+2
 1028 03e0 B091 0000 		lds r27,(rx_failure_cnt)+3
 1029               	.L74:
 1030 03e4 0196      		adiw r24,1
 1031 03e6 A11D      		adc r26,__zero_reg__
 1032 03e8 B11D      		adc r27,__zero_reg__
 1033 03ea 8093 0000 		sts rx_failure_cnt,r24
 1034 03ee 9093 0000 		sts (rx_failure_cnt)+1,r25
 1035 03f2 A093 0000 		sts (rx_failure_cnt)+2,r26
 1036 03f6 B093 0000 		sts (rx_failure_cnt)+3,r27
 1037               	.L73:
 1039               	.LM118:
 1040 03fa 0E94 0000 		call rf_rx_off
 1041 03fe 00C0      		rjmp .L72
 1042               	.L76:
 1044               	.LM119:
 1045 0400 10E0      		ldi r17,lo8(0)
 1046               	.L65:
 1048               	.LM120:
 1049 0402 0E94 0000 		call rf_polling_rx_packet
 1050 0406 8823      		tst r24
 1051 0408 01F0      		breq .L66
 1053               	.LM121:
 1054 040a 8983      		std Y+1,r24
 1055 040c 0E94 0000 		call rf_rx_off
 1057               	.LM122:
 1058 0410 8981      		ldd r24,Y+1
 1059 0412 8130      		cpi r24,lo8(1)
 1060 0414 01F4      		brne .L67
 1062               	.LM123:
 1063 0416 1092 0000 		sts rx_buf_empty,__zero_reg__
 1065               	.LM124:
 1066 041a 00C0      		rjmp .L62
 1067               	.L67:
 1069               	.LM125:
 1070 041c 8091 0000 		lds r24,rx_failure_cnt
 1071 0420 9091 0000 		lds r25,(rx_failure_cnt)+1
 1072 0424 A091 0000 		lds r26,(rx_failure_cnt)+2
 1073 0428 B091 0000 		lds r27,(rx_failure_cnt)+3
 1074 042c 0196      		adiw r24,1
 1075 042e A11D      		adc r26,__zero_reg__
 1076 0430 B11D      		adc r27,__zero_reg__
 1077 0432 8093 0000 		sts rx_failure_cnt,r24
 1078 0436 9093 0000 		sts (rx_failure_cnt)+1,r25
 1079 043a A093 0000 		sts (rx_failure_cnt)+2,r26
 1080 043e B093 0000 		sts (rx_failure_cnt)+3,r27
 1081               	.L72:
 1082 0442 80E0      		ldi r24,lo8(0)
 1083               	.L62:
 1084               	/* epilogue start */
 1086               	.LM126:
 1087 0444 0F90      		pop __tmp_reg__
 1088 0446 CF91      		pop r28
 1089 0448 DF91      		pop r29
 1090 044a 1F91      		pop r17
 1091 044c 0895      		ret
 1097               	.Lscope19:
 1099               		.stabd	78,0,0
 1101               	.global	bmac_get_tx_done_signal
 1103               	bmac_get_tx_done_signal:
 1104               		.stabd	46,0,0
 1106               	.LM127:
 1107               	.LFBB20:
 1108               	/* prologue: function */
 1109               	/* frame size = 0 */
 1111               	.LM128:
 1112 044e 8091 0000 		lds r24,bmac_tx_pkt_done_signal
 1113 0452 0E94 0000 		call nrk_signal_register
 1115               	.LM129:
 1116 0456 8091 0000 		lds r24,bmac_tx_pkt_done_signal
 1117               	/* epilogue start */
 1118 045a 0895      		ret
 1120               	.Lscope20:
 1122               		.stabd	78,0,0
 1124               	.global	bmac_get_rx_pkt_signal
 1126               	bmac_get_rx_pkt_signal:
 1127               		.stabd	46,0,0
 1129               	.LM130:
 1130               	.LFBB21:
 1131               	/* prologue: function */
 1132               	/* frame size = 0 */
 1134               	.LM131:
 1135 045c 8091 0000 		lds r24,bmac_rx_pkt_signal
 1136 0460 0E94 0000 		call nrk_signal_register
 1138               	.LM132:
 1139 0464 8091 0000 		lds r24,bmac_rx_pkt_signal
 1140               	/* epilogue start */
 1141 0468 0895      		ret
 1143               	.Lscope21:
 1145               		.stabd	78,0,0
 1147               	.global	bmac_nw_task
 1149               	bmac_nw_task:
 1150               		.stabd	46,0,0
 1152               	.LM133:
 1153               	.LFBB22:
 1154 046a EF92      		push r14
 1155 046c FF92      		push r15
 1156 046e 0F93      		push r16
 1157 0470 1F93      		push r17
 1158               	/* prologue: function */
 1159               	/* frame size = 0 */
 1161               	.LM134:
 1162 0472 00C0      		rjmp .L82
 1163               	.L83:
 1164 0474 0E94 0000 		call nrk_wait_until_next_period
 1165               	.L82:
 1166 0478 8091 0000 		lds r24,bmac_running
 1167 047c 8823      		tst r24
 1168 047e 01F0      		breq .L83
 1170               	.LM135:
 1171 0480 8091 0000 		lds r24,bmac_enable_signal
 1172 0484 0E94 0000 		call nrk_signal_register
 1174               	.LM136:
 1175 0488 8F3F      		cpi r24,lo8(-1)
 1176 048a 01F4      		brne .L92
 1177 048c 80E0      		ldi r24,lo8(__c.2505)
 1178 048e 90E0      		ldi r25,hi8(__c.2505)
 1179 0490 0E94 0000 		call nrk_kprintf
 1180               	.L92:
 1182               	.LM137:
 1183 0494 91E0      		ldi r25,lo8(1)
 1184 0496 E92E      		mov r14,r25
 1185 0498 F12C      		mov r15,__zero_reg__
 1186 049a 012D      		mov r16,__zero_reg__
 1187 049c 112D      		mov r17,__zero_reg__
 1188               	.L95:
 1190               	.LM138:
 1191 049e 8091 0000 		lds r24,is_enabled
 1192 04a2 8823      		tst r24
 1193 04a4 01F0      		breq .L93
 1195               	.LM139:
 1196 04a6 8091 0000 		lds r24,rx_buf_empty
 1197 04aa 8130      		cpi r24,lo8(1)
 1198 04ac 01F4      		brne .L96
 1199 04ae 0E94 0000 		call _bmac_channel_check
 1201               	.LM140:
 1202 04b2 8823      		tst r24
 1203 04b4 01F4      		brne .L88
 1205               	.LM141:
 1206 04b6 0E94 0000 		call _bmac_rx
 1207 04ba 8130      		cpi r24,lo8(1)
 1208 04bc 01F4      		brne .L88
 1209               	.L96:
 1211               	.LM142:
 1212 04be 8091 0000 		lds r24,bmac_rx_pkt_signal
 1213 04c2 0E94 0000 		call nrk_event_signal
 1214               	.L88:
 1216               	.LM143:
 1217 04c6 8091 0000 		lds r24,tx_data_ready
 1218 04ca 8130      		cpi r24,lo8(1)
 1219 04cc 01F4      		brne .L89
 1221               	.LM144:
 1222 04ce 0E94 0000 		call rf_rx_off
 1224               	.LM145:
 1225 04d2 0E94 0000 		call _bmac_tx
 1226               	.L89:
 1228               	.LM146:
 1229 04d6 2091 0000 		lds r18,_bmac_check_period
 1230 04da 3091 0000 		lds r19,_bmac_check_period+1
 1231 04de 4091 0000 		lds r20,_bmac_check_period+2
 1232 04e2 5091 0000 		lds r21,_bmac_check_period+3
 1233 04e6 6091 0000 		lds r22,_bmac_check_period+4
 1234 04ea 7091 0000 		lds r23,_bmac_check_period+5
 1235 04ee 8091 0000 		lds r24,_bmac_check_period+6
 1236 04f2 9091 0000 		lds r25,_bmac_check_period+7
 1237 04f6 0E94 0000 		call nrk_wait
 1238 04fa 00C0      		rjmp .L95
 1239               	.L93:
 1241               	.LM147:
 1242 04fc 8091 0000 		lds r24,bmac_enable_signal
 1243 0500 0E94 0000 		call nrk_signal_register
 1245               	.LM148:
 1246 0504 C801      		movw r24,r16
 1247 0506 B701      		movw r22,r14
 1248 0508 0090 0000 		lds r0,bmac_enable_signal
 1249 050c 00C0      		rjmp 2f
 1250 050e 660F      	1:	lsl r22
 1251 0510 771F      		rol r23
 1252 0512 881F      		rol r24
 1253 0514 991F      		rol r25
 1254 0516 0A94      	2:	dec r0
 1255 0518 02F4      		brpl 1b
 1256 051a 0E94 0000 		call nrk_event_wait
 1258               	.LM149:
 1259 051e 0090 0000 		lds r0,bmac_enable_signal
 1260 0522 00C0      		rjmp 2f
 1261 0524 9695      	1:	lsr r25
 1262 0526 8795      		ror r24
 1263 0528 7795      		ror r23
 1264 052a 6795      		ror r22
 1265 052c 0A94      	2:	dec r0
 1266 052e 02F4      		brpl 1b
 1267 0530 6170      		andi r22,lo8(1)
 1268 0532 7070      		andi r23,hi8(1)
 1269 0534 8070      		andi r24,hlo8(1)
 1270 0536 9070      		andi r25,hhi8(1)
 1271 0538 6115      		cp r22,__zero_reg__
 1272 053a 7105      		cpc r23,__zero_reg__
 1273 053c 8105      		cpc r24,__zero_reg__
 1274 053e 9105      		cpc r25,__zero_reg__
 1275 0540 01F0      		breq .L93
 1276 0542 00C0      		rjmp .L95
 1278               	.Lscope22:
 1280               		.stabd	78,0,0
 1284               	.global	bmac_tx_pkt
 1286               	bmac_tx_pkt:
 1287               		.stabd	46,0,0
 1289               	.LM150:
 1290               	.LFBB23:
 1291 0544 EF92      		push r14
 1292 0546 FF92      		push r15
 1293 0548 0F93      		push r16
 1294 054a 1F93      		push r17
 1295 054c DF93      		push r29
 1296 054e CF93      		push r28
 1297 0550 0F92      		push __tmp_reg__
 1298 0552 CDB7      		in r28,__SP_L__
 1299 0554 DEB7      		in r29,__SP_H__
 1300               	/* prologue: function */
 1301               	/* frame size = 1 */
 1302 0556 7C01      		movw r14,r24
 1304               	.LM151:
 1305 0558 8091 0000 		lds r24,tx_data_ready
 1306 055c 8130      		cpi r24,lo8(1)
 1307 055e 01F4      		brne .+2
 1308 0560 00C0      		rjmp .L98
 1310               	.LM152:
 1311 0562 8091 0000 		lds r24,bmac_tx_pkt_done_signal
 1312 0566 6983      		std Y+1,r22
 1313 0568 0E94 0000 		call nrk_signal_register
 1315               	.LM153:
 1316 056c 81E0      		ldi r24,lo8(1)
 1317 056e 8093 0000 		sts tx_data_ready,r24
 1319               	.LM154:
 1320 0572 F092 0000 		sts (bmac_rfTxInfo+3)+1,r15
 1321 0576 E092 0000 		sts bmac_rfTxInfo+3,r14
 1323               	.LM155:
 1324 057a 6981      		ldd r22,Y+1
 1325 057c 6093 0000 		sts bmac_rfTxInfo+2,r22
 1327               	.LM156:
 1328 0580 61E0      		ldi r22,lo8(1)
 1329 0582 70E0      		ldi r23,hi8(1)
 1330 0584 80E0      		ldi r24,hlo8(1)
 1331 0586 90E0      		ldi r25,hhi8(1)
 1332 0588 0090 0000 		lds r0,bmac_tx_pkt_done_signal
 1333 058c 00C0      		rjmp 2f
 1334 058e 660F      	1:	lsl r22
 1335 0590 771F      		rol r23
 1336 0592 881F      		rol r24
 1337 0594 991F      		rol r25
 1338 0596 0A94      	2:	dec r0
 1339 0598 02F4      		brpl 1b
 1340 059a 0E94 0000 		call nrk_event_wait
 1341 059e 7B01      		movw r14,r22
 1342 05a0 8C01      		movw r16,r24
 1344               	.LM157:
 1345 05a2 6115      		cp r22,__zero_reg__
 1346 05a4 7105      		cpc r23,__zero_reg__
 1347 05a6 8105      		cpc r24,__zero_reg__
 1348 05a8 9105      		cpc r25,__zero_reg__
 1349 05aa 01F4      		brne .L99
 1350 05ac 80E0      		ldi r24,lo8(__c.2449)
 1351 05ae 90E0      		ldi r25,hi8(__c.2449)
 1352 05b0 0E94 0000 		call nrk_kprintf
 1353               	.L99:
 1355               	.LM158:
 1356 05b4 D801      		movw r26,r16
 1357 05b6 C701      		movw r24,r14
 1358 05b8 0090 0000 		lds r0,bmac_tx_pkt_done_signal
 1359 05bc 00C0      		rjmp 2f
 1360 05be B695      	1:	lsr r27
 1361 05c0 A795      		ror r26
 1362 05c2 9795      		ror r25
 1363 05c4 8795      		ror r24
 1364 05c6 0A94      	2:	dec r0
 1365 05c8 02F4      		brpl 1b
 1366 05ca 8170      		andi r24,lo8(1)
 1367 05cc 9070      		andi r25,hi8(1)
 1368 05ce A070      		andi r26,hlo8(1)
 1369 05d0 B070      		andi r27,hhi8(1)
 1370 05d2 0097      		sbiw r24,0
 1371 05d4 A105      		cpc r26,__zero_reg__
 1372 05d6 B105      		cpc r27,__zero_reg__
 1373 05d8 01F4      		brne .L100
 1374 05da 80E0      		ldi r24,lo8(__c.2451)
 1375 05dc 90E0      		ldi r25,hi8(__c.2451)
 1376 05de 0E94 0000 		call nrk_kprintf
 1377               	.L100:
 1379               	.LM159:
 1380 05e2 8091 0000 		lds r24,pkt_got_ack
 1381 05e6 8823      		tst r24
 1382 05e8 01F0      		breq .L98
 1383 05ea 81E0      		ldi r24,lo8(1)
 1384 05ec 00C0      		rjmp .L101
 1385               	.L98:
 1386 05ee 8FEF      		ldi r24,lo8(-1)
 1387               	.L101:
 1388               	/* epilogue start */
 1390               	.LM160:
 1391 05f0 0F90      		pop __tmp_reg__
 1392 05f2 CF91      		pop r28
 1393 05f4 DF91      		pop r29
 1394 05f6 1F91      		pop r17
 1395 05f8 0F91      		pop r16
 1396 05fa FF90      		pop r15
 1397 05fc EF90      		pop r14
 1398 05fe 0895      		ret
 1403               	.Lscope23:
 1405               		.stabd	78,0,0
 1407               	.global	bmac_wait_until_rx_pkt
 1409               	bmac_wait_until_rx_pkt:
 1410               		.stabd	46,0,0
 1412               	.LM161:
 1413               	.LFBB24:
 1414               	/* prologue: function */
 1415               	/* frame size = 0 */
 1417               	.LM162:
 1418 0600 8091 0000 		lds r24,rx_buf_empty
 1419 0604 8823      		tst r24
 1420 0606 01F0      		breq .L104
 1422               	.LM163:
 1423 0608 8091 0000 		lds r24,bmac_rx_pkt_signal
 1424 060c 0E94 0000 		call nrk_signal_register
 1426               	.LM164:
 1427 0610 61E0      		ldi r22,lo8(1)
 1428 0612 70E0      		ldi r23,hi8(1)
 1429 0614 80E0      		ldi r24,hlo8(1)
 1430 0616 90E0      		ldi r25,hhi8(1)
 1431 0618 0090 0000 		lds r0,bmac_rx_pkt_signal
 1432 061c 00C0      		rjmp 2f
 1433 061e 660F      	1:	lsl r22
 1434 0620 771F      		rol r23
 1435 0622 881F      		rol r24
 1436 0624 991F      		rol r25
 1437 0626 0A94      	2:	dec r0
 1438 0628 02F4      		brpl 1b
 1439 062a 0E94 0000 		call nrk_event_wait
 1441               	.LM165:
 1442 062e 0090 0000 		lds r0,bmac_rx_pkt_signal
 1443 0632 00C0      		rjmp 2f
 1444 0634 9695      	1:	lsr r25
 1445 0636 8795      		ror r24
 1446 0638 7795      		ror r23
 1447 063a 6795      		ror r22
 1448 063c 0A94      	2:	dec r0
 1449 063e 02F4      		brpl 1b
 1450 0640 6170      		andi r22,lo8(1)
 1451 0642 7070      		andi r23,hi8(1)
 1452 0644 8070      		andi r24,hlo8(1)
 1453 0646 9070      		andi r25,hhi8(1)
 1454 0648 6115      		cp r22,__zero_reg__
 1455 064a 7105      		cpc r23,__zero_reg__
 1456 064c 8105      		cpc r24,__zero_reg__
 1457 064e 9105      		cpc r25,__zero_reg__
 1458 0650 01F4      		brne .L104
 1459 0652 8FEF      		ldi r24,lo8(-1)
 1460 0654 0895      		ret
 1461               	.L104:
 1462 0656 81E0      		ldi r24,lo8(1)
 1464               	.LM166:
 1465 0658 0895      		ret
 1467               	.Lscope24:
 1469               		.stabd	78,0,0
 1471               	.global	bmac_enable
 1473               	bmac_enable:
 1474               		.stabd	46,0,0
 1476               	.LM167:
 1477               	.LFBB25:
 1478               	/* prologue: function */
 1479               	/* frame size = 0 */
 1481               	.LM168:
 1482 065a 81E0      		ldi r24,lo8(1)
 1483 065c 8093 0000 		sts is_enabled,r24
 1485               	.LM169:
 1486 0660 0E94 0000 		call rf_power_up
 1488               	.LM170:
 1489 0664 8091 0000 		lds r24,bmac_enable_signal
 1490 0668 0E94 0000 		call nrk_event_signal
 1491               	/* epilogue start */
 1493               	.LM171:
 1494 066c 0895      		ret
 1496               	.Lscope25:
 1498               		.stabd	78,0,0
 1500               	.global	bmac_disable
 1502               	bmac_disable:
 1503               		.stabd	46,0,0
 1505               	.LM172:
 1506               	.LFBB26:
 1507               	/* prologue: function */
 1508               	/* frame size = 0 */
 1510               	.LM173:
 1511 066e 1092 0000 		sts is_enabled,__zero_reg__
 1513               	.LM174:
 1514 0672 0E94 0000 		call rf_power_down
 1515               	/* epilogue start */
 1517               	.LM175:
 1518 0676 0895      		ret
 1520               	.Lscope26:
 1522               		.stabd	78,0,0
 1525               	.global	bmac_set_channel
 1527               	bmac_set_channel:
 1528               		.stabd	46,0,0
 1530               	.LM176:
 1531               	.LFBB27:
 1532               	/* prologue: function */
 1533               	/* frame size = 0 */
 1534 0678 682F      		mov r22,r24
 1536               	.LM177:
 1537 067a 8B31      		cpi r24,lo8(27)
 1538 067c 00F0      		brlo .L112
 1539 067e 8FEF      		ldi r24,lo8(-1)
 1540 0680 0895      		ret
 1541               	.L112:
 1543               	.LM178:
 1544 0682 8093 0000 		sts g_chan,r24
 1546               	.LM179:
 1547 0686 80E0      		ldi r24,lo8(bmac_rfRxInfo)
 1548 0688 90E0      		ldi r25,hi8(bmac_rfRxInfo)
 1549 068a 4FEF      		ldi r20,lo8(-1)
 1550 068c 5FEF      		ldi r21,hi8(-1)
 1551 068e 20E0      		ldi r18,lo8(0)
 1552 0690 30E0      		ldi r19,hi8(0)
 1553 0692 0E94 0000 		call rf_init
 1554 0696 81E0      		ldi r24,lo8(1)
 1556               	.LM180:
 1557 0698 0895      		ret
 1559               	.Lscope27:
 1561               		.stabd	78,0,0
 1564               	.global	bmac_init
 1566               	bmac_init:
 1567               		.stabd	46,0,0
 1569               	.LM181:
 1570               	.LFBB28:
 1571 069a 1F93      		push r17
 1572               	/* prologue: function */
 1573               	/* frame size = 0 */
 1574 069c 182F      		mov r17,r24
 1576               	.LM182:
 1577 069e 1092 0000 		sts bmac_running,__zero_reg__
 1579               	.LM183:
 1580 06a2 8FEF      		ldi r24,lo8(-1)
 1581 06a4 8093 0000 		sts tx_reserve,r24
 1583               	.LM184:
 1584 06a8 81E0      		ldi r24,lo8(1)
 1585 06aa 8093 0000 		sts cca_active,r24
 1587               	.LM185:
 1588 06ae 1092 0000 		sts rx_failure_cnt,__zero_reg__
 1589 06b2 1092 0000 		sts (rx_failure_cnt)+1,__zero_reg__
 1590 06b6 1092 0000 		sts (rx_failure_cnt)+2,__zero_reg__
 1591 06ba 1092 0000 		sts (rx_failure_cnt)+3,__zero_reg__
 1593               	.LM186:
 1594 06be 1092 0000 		sts _bmac_check_period,__zero_reg__
 1595 06c2 1092 0000 		sts (_bmac_check_period)+1,__zero_reg__
 1596 06c6 1092 0000 		sts (_bmac_check_period)+2,__zero_reg__
 1597 06ca 1092 0000 		sts (_bmac_check_period)+3,__zero_reg__
 1599               	.LM187:
 1600 06ce 80E0      		ldi r24,lo8(100000000)
 1601 06d0 91EE      		ldi r25,hi8(100000000)
 1602 06d2 A5EF      		ldi r26,hlo8(100000000)
 1603 06d4 B5E0      		ldi r27,hhi8(100000000)
 1604 06d6 8093 0000 		sts _bmac_check_period+4,r24
 1605 06da 9093 0000 		sts (_bmac_check_period+4)+1,r25
 1606 06de A093 0000 		sts (_bmac_check_period+4)+2,r26
 1607 06e2 B093 0000 		sts (_bmac_check_period+4)+3,r27
 1609               	.LM188:
 1610 06e6 0E94 0000 		call nrk_signal_create
 1611 06ea 8093 0000 		sts bmac_rx_pkt_signal,r24
 1613               	.LM189:
 1614 06ee 8F3F      		cpi r24,lo8(-1)
 1615 06f0 01F4      		brne .L116
 1617               	.LM190:
 1618 06f2 80E0      		ldi r24,lo8(__c.2345)
 1619 06f4 90E0      		ldi r25,hi8(__c.2345)
 1620 06f6 00C0      		rjmp .L139
 1621               	.L116:
 1623               	.LM191:
 1624 06f8 0E94 0000 		call nrk_signal_create
 1625 06fc 8093 0000 		sts bmac_tx_pkt_done_signal,r24
 1627               	.LM192:
 1628 0700 8F3F      		cpi r24,lo8(-1)
 1629 0702 01F4      		brne .L118
 1631               	.LM193:
 1632 0704 80E0      		ldi r24,lo8(__c.2347)
 1633 0706 90E0      		ldi r25,hi8(__c.2347)
 1634               	.L139:
 1635 0708 0E94 0000 		call nrk_kprintf
 1637               	.LM194:
 1638 070c E091 0000 		lds r30,nrk_cur_task_TCB
 1639 0710 F091 0000 		lds r31,(nrk_cur_task_TCB)+1
 1640 0714 8EE0      		ldi r24,lo8(14)
 1641 0716 6085      		ldd r22,Z+8
 1642 0718 0E94 0000 		call nrk_kernel_error_add
 1643 071c 8FEF      		ldi r24,lo8(-1)
 1645               	.LM195:
 1646 071e 00C0      		rjmp .L117
 1647               	.L118:
 1649               	.LM196:
 1650 0720 0E94 0000 		call nrk_signal_create
 1651 0724 8093 0000 		sts bmac_enable_signal,r24
 1653               	.LM197:
 1654 0728 8F3F      		cpi r24,lo8(-1)
 1655 072a 01F4      		brne .L119
 1657               	.LM198:
 1658 072c 80E0      		ldi r24,lo8(__c.2349)
 1659 072e 90E0      		ldi r25,hi8(__c.2349)
 1660 0730 00C0      		rjmp .L139
 1661               	.L119:
 1663               	.LM199:
 1664 0732 1092 0000 		sts tx_data_ready,__zero_reg__
 1666               	.LM200:
 1667 0736 1092 0000 		sts rx_buf_empty,__zero_reg__
 1669               	.LM201:
 1670 073a 1092 0000 		sts (bmac_rfRxInfo+5)+1,__zero_reg__
 1671 073e 1092 0000 		sts bmac_rfRxInfo+5,__zero_reg__
 1673               	.LM202:
 1674 0742 1092 0000 		sts bmac_rfRxInfo+4,__zero_reg__
 1676               	.LM203:
 1677 0746 80E0      		ldi r24,lo8(bmac_rfRxInfo)
 1678 0748 90E0      		ldi r25,hi8(bmac_rfRxInfo)
 1679 074a 612F      		mov r22,r17
 1680 074c 4FEF      		ldi r20,lo8(-1)
 1681 074e 5FEF      		ldi r21,hi8(-1)
 1682 0750 20E0      		ldi r18,lo8(0)
 1683 0752 30E0      		ldi r19,hi8(0)
 1684 0754 0E94 0000 		call rf_init
 1686               	.LM204:
 1687 0758 1093 0000 		sts g_chan,r17
 1689               	.LM205:
 1690 075c C098      		cbi 56-0x20,0
 1691 075e 83E1      		ldi r24,lo8(19)
 1692 0760 8FB9      		out 47-0x20,r24
 1693               	.L120:
 1694 0762 779B      		sbis 46-0x20,7
 1695 0764 00C0      		rjmp .L120
 1696 0766 85EE      		ldi r24,lo8(-27)
 1697 0768 8FB9      		out 47-0x20,r24
 1698               	.L121:
 1699 076a 779B      		sbis 46-0x20,7
 1700 076c 00C0      		rjmp .L121
 1701 076e 80E8      		ldi r24,lo8(-128)
 1702 0770 8FB9      		out 47-0x20,r24
 1703               	.L122:
 1704 0772 779B      		sbis 46-0x20,7
 1705 0774 00C0      		rjmp .L122
 1706 0776 C09A      		sbi 56-0x20,0
 1708               	.LM206:
 1709 0778 C098      		cbi 56-0x20,0
 1710 077a 85E1      		ldi r24,lo8(21)
 1711 077c 8FB9      		out 47-0x20,r24
 1712               	.L123:
 1713 077e 779B      		sbis 46-0x20,7
 1714 0780 00C0      		rjmp .L123
 1715 0782 80E8      		ldi r24,lo8(-128)
 1716 0784 8FB9      		out 47-0x20,r24
 1717               	.L124:
 1718 0786 779B      		sbis 46-0x20,7
 1719 0788 00C0      		rjmp .L124
 1720 078a 8FEF      		ldi r24,lo8(-1)
 1721 078c 8FB9      		out 47-0x20,r24
 1722               	.L125:
 1723 078e 779B      		sbis 46-0x20,7
 1724 0790 00C0      		rjmp .L125
 1725 0792 C09A      		sbi 56-0x20,0
 1727               	.LM207:
 1728 0794 C098      		cbi 56-0x20,0
 1729 0796 87E1      		ldi r24,lo8(23)
 1730 0798 8FB9      		out 47-0x20,r24
 1731               	.L126:
 1732 079a 779B      		sbis 46-0x20,7
 1733 079c 00C0      		rjmp .L126
 1734 079e 8AE0      		ldi r24,lo8(10)
 1735 07a0 8FB9      		out 47-0x20,r24
 1736               	.L127:
 1737 07a2 779B      		sbis 46-0x20,7
 1738 07a4 00C0      		rjmp .L127
 1739 07a6 86E5      		ldi r24,lo8(86)
 1740 07a8 8FB9      		out 47-0x20,r24
 1741               	.L128:
 1742 07aa 779B      		sbis 46-0x20,7
 1743 07ac 00C0      		rjmp .L128
 1744 07ae C09A      		sbi 56-0x20,0
 1746               	.LM208:
 1747 07b0 83ED      		ldi r24,lo8(-45)
 1748 07b2 0E94 0000 		call rf_set_cca_thresh
 1750               	.LM209:
 1751 07b6 81E0      		ldi r24,lo8(1)
 1752 07b8 8093 0000 		sts bmac_running,r24
 1754               	.LM210:
 1755 07bc 8093 0000 		sts is_enabled,r24
 1756               	.L117:
 1757               	/* epilogue start */
 1759               	.LM211:
 1760 07c0 1F91      		pop r17
 1761 07c2 0895      		ret
 1763               	.Lscope28:
 1765               		.stabd	78,0,0
 1768               	.global	bmac_set_cca_thresh
 1770               	bmac_set_cca_thresh:
 1771               		.stabd	46,0,0
 1773               	.LM212:
 1774               	.LFBB29:
 1775               	/* prologue: function */
 1776               	/* frame size = 0 */
 1778               	.LM213:
 1779 07c4 0E94 0000 		call rf_set_cca_thresh
 1781               	.LM214:
 1782 07c8 81E0      		ldi r24,lo8(1)
 1783               	/* epilogue start */
 1784 07ca 0895      		ret
 1786               	.Lscope29:
 1788               		.stabd	78,0,0
 1791               	.global	bmac_set_rf_power
 1793               	bmac_set_rf_power:
 1794               		.stabd	46,0,0
 1796               	.LM215:
 1797               	.LFBB30:
 1798               	/* prologue: function */
 1799               	/* frame size = 0 */
 1801               	.LM216:
 1802 07cc 8032      		cpi r24,lo8(32)
 1803 07ce 00F0      		brlo .L143
 1804 07d0 8FEF      		ldi r24,lo8(-1)
 1805 07d2 0895      		ret
 1806               	.L143:
 1808               	.LM217:
 1809 07d4 0E94 0000 		call rf_tx_power
 1810 07d8 81E0      		ldi r24,lo8(1)
 1812               	.LM218:
 1813 07da 0895      		ret
 1815               	.Lscope30:
 1817               		.stabd	78,0,0
 1819               	.global	bmac_encryption_disable
 1821               	bmac_encryption_disable:
 1822               		.stabd	46,0,0
 1824               	.LM219:
 1825               	.LFBB31:
 1826               	/* prologue: function */
 1827               	/* frame size = 0 */
 1829               	.LM220:
 1830 07dc 0E94 0000 		call rf_security_disable
 1832               	.LM221:
 1833 07e0 81E0      		ldi r24,lo8(1)
 1834               	/* epilogue start */
 1835 07e2 0895      		ret
 1837               	.Lscope31:
 1839               		.stabd	78,0,0
 1841               	.global	bmac_encryption_enable
 1843               	bmac_encryption_enable:
 1844               		.stabd	46,0,0
 1846               	.LM222:
 1847               	.LFBB32:
 1848               	/* prologue: function */
 1849               	/* frame size = 0 */
 1851               	.LM223:
 1852 07e4 0E94 0000 		call rf_security_enable
 1854               	.LM224:
 1855 07e8 81E0      		ldi r24,lo8(1)
 1856               	/* epilogue start */
 1857 07ea 0895      		ret
 1859               	.Lscope32:
 1861               		.stabd	78,0,0
 1865               	.global	bmac_encryption_set_key
 1867               	bmac_encryption_set_key:
 1868               		.stabd	46,0,0
 1870               	.LM225:
 1871               	.LFBB33:
 1872               	/* prologue: function */
 1873               	/* frame size = 0 */
 1875               	.LM226:
 1876 07ec 6031      		cpi r22,lo8(16)
 1877 07ee 01F0      		breq .L151
 1878 07f0 8FEF      		ldi r24,lo8(-1)
 1879 07f2 0895      		ret
 1880               	.L151:
 1882               	.LM227:
 1883 07f4 0E94 0000 		call rf_security_set_key
 1884 07f8 81E0      		ldi r24,lo8(1)
 1886               	.LM228:
 1887 07fa 0895      		ret
 1889               	.Lscope33:
 1891               		.stabd	78,0,0
 1893               	.global	bmac_rx_pkt_is_encrypted
 1895               	bmac_rx_pkt_is_encrypted:
 1896               		.stabd	46,0,0
 1898               	.LM229:
 1899               	.LFBB34:
 1900               	/* prologue: function */
 1901               	/* frame size = 0 */
 1903               	.LM230:
 1904 07fc 0E94 0000 		call rf_security_last_pkt_status
 1905               	/* epilogue start */
 1907               	.LM231:
 1908 0800 0895      		ret
 1910               	.Lscope34:
 1912               		.stabd	78,0,0
 1915               	.global	bmac_addr_decode_set_my_mac
 1917               	bmac_addr_decode_set_my_mac:
 1918               		.stabd	46,0,0
 1920               	.LM232:
 1921               	.LFBB35:
 1922               	/* prologue: function */
 1923               	/* frame size = 0 */
 1925               	.LM233:
 1926 0802 0E94 0000 		call rf_addr_decode_set_my_mac
 1928               	.LM234:
 1929 0806 81E0      		ldi r24,lo8(1)
 1930               	/* epilogue start */
 1931 0808 0895      		ret
 1933               	.Lscope35:
 1935               		.stabd	78,0,0
 1937               	.global	bmac_addr_decode_enable
 1939               	bmac_addr_decode_enable:
 1940               		.stabd	46,0,0
 1942               	.LM235:
 1943               	.LFBB36:
 1944               	/* prologue: function */
 1945               	/* frame size = 0 */
 1947               	.LM236:
 1948 080a 0E94 0000 		call rf_addr_decode_enable
 1950               	.LM237:
 1951 080e 81E0      		ldi r24,lo8(1)
 1952               	/* epilogue start */
 1953 0810 0895      		ret
 1955               	.Lscope36:
 1957               		.stabd	78,0,0
 1959               	.global	bmac_addr_decode_disable
 1961               	bmac_addr_decode_disable:
 1962               		.stabd	46,0,0
 1964               	.LM238:
 1965               	.LFBB37:
 1966               	/* prologue: function */
 1967               	/* frame size = 0 */
 1969               	.LM239:
 1970 0812 0E94 0000 		call rf_addr_decode_disable
 1972               	.LM240:
 1973 0816 81E0      		ldi r24,lo8(1)
 1974               	/* epilogue start */
 1975 0818 0895      		ret
 1977               	.Lscope37:
 1979               		.stabd	78,0,0
 1981               	.global	bmac_auto_ack_enable
 1983               	bmac_auto_ack_enable:
 1984               		.stabd	46,0,0
 1986               	.LM241:
 1987               	.LFBB38:
 1988               	/* prologue: function */
 1989               	/* frame size = 0 */
 1991               	.LM242:
 1992 081a 0E94 0000 		call rf_auto_ack_enable
 1994               	.LM243:
 1995 081e 81E0      		ldi r24,lo8(1)
 1996               	/* epilogue start */
 1997 0820 0895      		ret
 1999               	.Lscope38:
 2001               		.stabd	78,0,0
 2003               	.global	bmac_auto_ack_disable
 2005               	bmac_auto_ack_disable:
 2006               		.stabd	46,0,0
 2008               	.LM244:
 2009               	.LFBB39:
 2010               	/* prologue: function */
 2011               	/* frame size = 0 */
 2013               	.LM245:
 2014 0822 0E94 0000 		call rf_auto_ack_disable
 2016               	.LM246:
 2017 0826 81E0      		ldi r24,lo8(1)
 2018               	/* epilogue start */
 2019 0828 0895      		ret
 2021               	.Lscope39:
 2023               		.stabd	78,0,0
 2027               	.global	bmac_encryption_set_ctr_counter
 2029               	bmac_encryption_set_ctr_counter:
 2030               		.stabd	46,0,0
 2032               	.LM247:
 2033               	.LFBB40:
 2034               	/* prologue: function */
 2035               	/* frame size = 0 */
 2037               	.LM248:
 2038 082a 6430      		cpi r22,lo8(4)
 2039 082c 01F0      		breq .L167
 2040 082e 8FEF      		ldi r24,lo8(-1)
 2041 0830 0895      		ret
 2042               	.L167:
 2044               	.LM249:
 2045 0832 0E94 0000 		call rf_security_set_ctr_counter
 2046 0836 81E0      		ldi r24,lo8(1)
 2048               	.LM250:
 2049 0838 0895      		ret
 2051               	.Lscope40:
 2053               		.stabd	78,0,0
 2054               		.section	.progmem.data,"a",@progbits
 2057               	__c.2505:
 2058 0000 4661 696C 		.string	"Failed to register signal\r\n"
 2058      6564 2074 
 2058      6F20 7265 
 2058      6769 7374 
 2058      6572 2073 
 2061               	__c.2451:
 2062 001c 424D 4143 		.string	"BMAC TX: Woke up on wrong signal\r\n"
 2062      2054 583A 
 2062      2057 6F6B 
 2062      6520 7570 
 2062      206F 6E20 
 2065               	__c.2449:
 2066 003f 424D 4143 		.string	"BMAC TX: Error calling event wait\r\n"
 2066      2054 583A 
 2066      2045 7272 
 2066      6F72 2063 
 2066      616C 6C69 
 2069               	__c.2349:
 2070 0063 424D 4143 		.string	"BMAC ERROR: creating enable signal failed\r\n"
 2070      2045 5252 
 2070      4F52 3A20 
 2070      6372 6561 
 2070      7469 6E67 
 2073               	__c.2347:
 2074 008f 424D 4143 		.string	"BMAC ERROR: creating tx signal failed\r\n"
 2074      2045 5252 
 2074      4F52 3A20 
 2074      6372 6561 
 2074      7469 6E67 
 2077               	__c.2345:
 2078 00b7 424D 4143 		.string	"BMAC ERROR: creating rx signal failed\r\n"
 2078      2045 5252 
 2078      4F52 3A20 
 2078      6372 6561 
 2078      7469 6E67 
 2079               		.lcomm bmac_task,35
 2080               		.lcomm bmac_task_stack,128
 2081               		.lcomm rx_failure_cnt,4
 2082               		.lcomm tx_data_ready,1
 2083               		.lcomm rx_buf_empty,1
 2084               		.lcomm bmac_running,1
 2085               		.lcomm pkt_got_ack,1
 2086               		.lcomm g_chan,1
 2087               		.lcomm is_enabled,1
 2088               		.lcomm _bmac_check_period,8
 2089               		.lcomm cca_active,1
 2090               		.lcomm tx_reserve,1
 2091               		.comm _nrk_signal_list,4,1
 2092               		.comm nrk_idle_task_stk,128,1
 2093               		.comm nrk_kernel_stk_ptr,2,1
 2094               		.comm _nrk_prev_timer_val,1,1
 2095               		.comm _nrk_time_trigger,1,1
 2096               		.comm app_timer0_callback,2,1
 2097               		.comm app_timer0_prescale,1,1
 2098               		.comm error_task,1,1
 2099               		.comm error_num,1,1
 2100               		.comm bmac_rx_pkt_signal,1,1
 2101               		.comm bmac_tx_pkt_done_signal,1,1
 2102               		.comm bmac_enable_signal,1,1
 2103               		.comm bmac_rfRxInfo,9,1
 2104               		.comm bmac_rfTxInfo,7,1
 2131               		.text
 2133               	.Letext0:
DEFINED SYMBOLS
                            *ABS*:00000000 bmac.c
     /tmp/ccGqLi0f.s:2      *ABS*:0000003f __SREG__
     /tmp/ccGqLi0f.s:3      *ABS*:0000003e __SP_H__
     /tmp/ccGqLi0f.s:4      *ABS*:0000003d __SP_L__
     /tmp/ccGqLi0f.s:5      *ABS*:00000000 __tmp_reg__
     /tmp/ccGqLi0f.s:6      *ABS*:00000001 __zero_reg__
     /tmp/ccGqLi0f.s:148    .text:00000000 rf_rx_callback
     /tmp/ccGqLi0f.s:168    .text:00000002 bmac_tx_reserve_set
     /tmp/ccGqLi0f.s:187    .text:00000006 bmac_tx_reserve_get
     /tmp/ccGqLi0f.s:208    .text:0000000c bmac_addr_decode_dest_mac
                            *COM*:00000007 bmac_rfTxInfo
     /tmp/ccGqLi0f.s:232    .text:00000018 bmac_set_cca_active
     /tmp/ccGqLi0f.s:2088   .bss:000000b5 cca_active
     /tmp/ccGqLi0f.s:255    .text:0000001e bmac_rx_pkt_set_buffer
                            *COM*:00000009 bmac_rfRxInfo
     /tmp/ccGqLi0f.s:2082   .bss:000000a8 rx_buf_empty
     /tmp/ccGqLi0f.s:292    .text:0000003a bmac_tx_pkt_nonblocking
     /tmp/ccGqLi0f.s:2081   .bss:000000a7 tx_data_ready
     /tmp/ccGqLi0f.s:331    .text:0000005c bmac_rx_pkt_get
     /tmp/ccGqLi0f.s:382    .text:0000008a bmac_rx_pkt_ready
     /tmp/ccGqLi0f.s:407    .text:00000098 bmac_rx_pkt_release
     /tmp/ccGqLi0f.s:430    .text:000000a0 bmac_set_rx_check_rate
     /tmp/ccGqLi0f.s:2087   .bss:000000ad _bmac_check_period
     /tmp/ccGqLi0f.s:516    .text:00000126 bmac_started
     /tmp/ccGqLi0f.s:2083   .bss:000000a9 bmac_running
     /tmp/ccGqLi0f.s:535    .text:0000012c bmac_rx_failure_count_get
     /tmp/ccGqLi0f.s:2080   .bss:000000a3 rx_failure_cnt
     /tmp/ccGqLi0f.s:555    .text:00000136 bmac_rx_failure_count_reset
     /tmp/ccGqLi0f.s:581    .text:0000014a _b_pow
     /tmp/ccGqLi0f.s:627    .text:00000168 bmac_task_config
                             .bss:00000000 bmac_task
     /tmp/ccGqLi0f.s:1149   .text:0000046a bmac_nw_task
     /tmp/ccGqLi0f.s:2079   .bss:00000023 bmac_task_stack
     /tmp/ccGqLi0f.s:727    .text:00000218 _bmac_channel_check
     /tmp/ccGqLi0f.s:783    .text:00000254 _bmac_tx
     /tmp/ccGqLi0f.s:2084   .bss:000000aa pkt_got_ack
                            *COM*:00000001 bmac_tx_pkt_done_signal
     /tmp/ccGqLi0f.s:943    .text:00000350 _bmac_rx
     /tmp/ccGqLi0f.s:2085   .bss:000000ab g_chan
     /tmp/ccGqLi0f.s:1103   .text:0000044e bmac_get_tx_done_signal
     /tmp/ccGqLi0f.s:1126   .text:0000045c bmac_get_rx_pkt_signal
                            *COM*:00000001 bmac_rx_pkt_signal
                            *COM*:00000001 bmac_enable_signal
     /tmp/ccGqLi0f.s:2057   .progmem.data:00000000 __c.2505
     /tmp/ccGqLi0f.s:2086   .bss:000000ac is_enabled
     /tmp/ccGqLi0f.s:1286   .text:00000544 bmac_tx_pkt
     /tmp/ccGqLi0f.s:2065   .progmem.data:0000003f __c.2449
     /tmp/ccGqLi0f.s:2061   .progmem.data:0000001c __c.2451
     /tmp/ccGqLi0f.s:1409   .text:00000600 bmac_wait_until_rx_pkt
     /tmp/ccGqLi0f.s:1473   .text:0000065a bmac_enable
     /tmp/ccGqLi0f.s:1502   .text:0000066e bmac_disable
     /tmp/ccGqLi0f.s:1527   .text:00000678 bmac_set_channel
     /tmp/ccGqLi0f.s:1566   .text:0000069a bmac_init
     /tmp/ccGqLi0f.s:2089   .bss:000000b6 tx_reserve
     /tmp/ccGqLi0f.s:2077   .progmem.data:000000b7 __c.2345
     /tmp/ccGqLi0f.s:2073   .progmem.data:0000008f __c.2347
     /tmp/ccGqLi0f.s:2069   .progmem.data:00000063 __c.2349
     /tmp/ccGqLi0f.s:1770   .text:000007c4 bmac_set_cca_thresh
     /tmp/ccGqLi0f.s:1793   .text:000007cc bmac_set_rf_power
     /tmp/ccGqLi0f.s:1821   .text:000007dc bmac_encryption_disable
     /tmp/ccGqLi0f.s:1843   .text:000007e4 bmac_encryption_enable
     /tmp/ccGqLi0f.s:1867   .text:000007ec bmac_encryption_set_key
     /tmp/ccGqLi0f.s:1895   .text:000007fc bmac_rx_pkt_is_encrypted
     /tmp/ccGqLi0f.s:1917   .text:00000802 bmac_addr_decode_set_my_mac
     /tmp/ccGqLi0f.s:1939   .text:0000080a bmac_addr_decode_enable
     /tmp/ccGqLi0f.s:1961   .text:00000812 bmac_addr_decode_disable
     /tmp/ccGqLi0f.s:1983   .text:0000081a bmac_auto_ack_enable
     /tmp/ccGqLi0f.s:2005   .text:00000822 bmac_auto_ack_disable
     /tmp/ccGqLi0f.s:2029   .text:0000082a bmac_encryption_set_ctr_counter
                            *COM*:00000004 _nrk_signal_list
                            *COM*:00000080 nrk_idle_task_stk
                            *COM*:00000002 nrk_kernel_stk_ptr
                            *COM*:00000001 _nrk_prev_timer_val
                            *COM*:00000001 _nrk_time_trigger
                            *COM*:00000002 app_timer0_callback
                            *COM*:00000001 app_timer0_prescale
                            *COM*:00000001 error_task
                            *COM*:00000001 error_num

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
nrk_task_set_entry_function
nrk_task_set_stk
nrk_activate_task
rf_polling_rx_on
nrk_spin_wait_us
rf_rx_off
_nrk_time_to_ticks
rand
__divmodhi4
__udivmodhi4
nrk_wait_until_ticks
nrk_wait_until_next_n_periods
rf_test_mode
rf_carrier_on
nrk_wait
rf_carrier_off
rf_data_mode
rf_tx_packet
nrk_event_signal
rf_set_rx
rf_rx_check_fifop
rf_polling_rx_packet
nrk_signal_register
nrk_wait_until_next_period
nrk_kprintf
nrk_event_wait
rf_power_up
rf_power_down
rf_init
nrk_signal_create
nrk_cur_task_TCB
nrk_kernel_error_add
rf_set_cca_thresh
rf_tx_power
rf_security_disable
rf_security_enable
rf_security_set_key
rf_security_last_pkt_status
rf_addr_decode_set_my_mac
rf_addr_decode_enable
rf_addr_decode_disable
rf_auto_ack_enable
rf_auto_ack_disable
rf_security_set_ctr_counter
